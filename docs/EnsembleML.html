<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Time series model - Machine Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="site_libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="site_libs/dygraphs-1.1.1/shapes.js"></script>
<script src="site_libs/moment-2.8.4/moment.js"></script>
<script src="site_libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="site_libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="site_libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Time series model</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Giới thiệu</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Forecasting.html" rel="" target="">
 <span class="menu-text">Mô hình ARIMA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./SARIMA.html" rel="" target="">
 <span class="menu-text">Mô hình SARIMA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./EnsembleML.html" rel="" target="" aria-current="page">
 <span class="menu-text">Machine Learning</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://github.com/Loccx78vn/Forecasting_time_series" rel="" title="Github" class="quarto-navigation-tool px-1" aria-label="Github"><i class="bi bi-github"></i></a>
    <a href="https://rpubs.com/loccx" rel="" title="Another projects" class="quarto-navigation-tool px-1" aria-label="Another projects"><i class="bi bi-twitter"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dự-đoán-bằng-machine-learning" id="toc-dự-đoán-bằng-machine-learning" class="nav-link active" data-scroll-target="#dự-đoán-bằng-machine-learning"><span class="header-section-number">1</span> Dự đoán bằng Machine Learning:</a>
  <ul class="collapse">
  <li><a href="#định-nghĩa-về-machine-learning" id="toc-định-nghĩa-về-machine-learning" class="nav-link" data-scroll-target="#định-nghĩa-về-machine-learning"><span class="header-section-number">1.1</span> Định nghĩa về Machine Learning:</a></li>
  <li><a href="#thuật-toán-ensemble-machine-learning" id="toc-thuật-toán-ensemble-machine-learning" class="nav-link" data-scroll-target="#thuật-toán-ensemble-machine-learning"><span class="header-section-number">1.2</span> Thuật toán Ensemble Machine Learning:</a></li>
  <li><a href="#so-sánh-với-mô-hình-arima" id="toc-so-sánh-với-mô-hình-arima" class="nav-link" data-scroll-target="#so-sánh-với-mô-hình-arima"><span class="header-section-number">1.3</span> So sánh với mô hình ARIMA:</a></li>
  </ul></li>
  <li><a href="#thực-hành-trong-r" id="toc-thực-hành-trong-r" class="nav-link" data-scroll-target="#thực-hành-trong-r"><span class="header-section-number">2</span> Thực hành trong R:</a>
  <ul class="collapse">
  <li><a href="#chuẩn-bị-dữ-liệu" id="toc-chuẩn-bị-dữ-liệu" class="nav-link" data-scroll-target="#chuẩn-bị-dữ-liệu"><span class="header-section-number">2.1</span> Chuẩn bị dữ liệu:</a></li>
  <li><a href="#xử-lí-missing-value-và-outliers" id="toc-xử-lí-missing-value-và-outliers" class="nav-link" data-scroll-target="#xử-lí-missing-value-và-outliers"><span class="header-section-number">2.2</span> Xử lí missing value và outliers:</a></li>
  <li><a href="#dự-đoán" id="toc-dự-đoán" class="nav-link" data-scroll-target="#dự-đoán"><span class="header-section-number">2.3</span> Dự đoán:</a></li>
  </ul></li>
  <li><a href="#tuning-parameters" id="toc-tuning-parameters" class="nav-link" data-scroll-target="#tuning-parameters"><span class="header-section-number">3</span> Tuning parameters:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Machine Learning</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Việt Nam, 2024</p>
  <div class="quarto-categories">
    <div class="quarto-category">Machine Learning</div>
    <div class="quarto-category">Forecasting</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="dự-đoán-bằng-machine-learning" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="dự-đoán-bằng-machine-learning"><span class="header-section-number">1</span> Dự đoán bằng Machine Learning:</h2>
<section id="định-nghĩa-về-machine-learning" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="định-nghĩa-về-machine-learning"><span class="header-section-number">1.1</span> Định nghĩa về Machine Learning:</h3>
<p>Theo <span class="citation" data-cites="topdev">(<a href="#ref-topdev" role="doc-biblioref">Topdev, n.d.</a>)</span>, Machine learning (ML) hay máy học là “<em>một nhánh của trí tuệ nhân tạo (AI), nó là một lĩnh vực nghiên cứu cho phép máy tính có khả năng cải thiện chính bản thân chúng dựa trên dữ liệu mẫu (training data) hoặc dựa vào kinh nghiệm (những gì đã được học). Machine learning có thể tự dự đoán hoặc đưa ra quyết định mà không cần được lập trình cụ thể.</em>”</p>
<p>Phương pháp Machine Learning từng “gây bão” trong giới khoa học khi ra mắt vì khả năng xây dựng mô hình nhanh chóng và sự chuẩn xác của mô hình trong việc dự đoán và phân loại kết quả. Với sự phát triển của khoa học, lượng lớn dữ liệu được thu thập hay được gọi là Big Data đòi hỏi nhu cầu tính toán nhanh chóng và công cụ mạnh. Các phương pháp khoa học truyền thống lại không làm tốt việc này bằng Machine Learning.</p>
<p>Ngoài ra, khác với các mô hình truyền thống đòi hỏi nhiều về đáp ứng giả định và quy tắc rắc rối, Machine Learning giúp con người nhanh chóng đưa ra quyết định và có thể tự cải thiện performance của mình bằng học máy mà không cần người dùng phải tương tác nhiều.</p>
</section>
<section id="thuật-toán-ensemble-machine-learning" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="thuật-toán-ensemble-machine-learning"><span class="header-section-number">1.2</span> Thuật toán Ensemble Machine Learning:</h3>
<p>Trong machine learning tồn tại định lý “<em>không có bữa trưa miễn phí”</em> (No free lunch theorem), tức là không tồn tại một thuật toán mà tốt cho mọi ứng dụng và mọi tập dữ liệu. Vì ML có nhiều thuật toán khác nhau và tùy vào đặc tính của bộ dữ liệu mà thuật toán ML sẽ tính ra kết quả khác nhau. Muốn tìm ra thuật toán phù hợp, người sử dụng phải cần nhiều thời gian để test và điều chỉnh hệ số (tuning hyperparameters) để đạt độ chính xác cao.</p>
<p>Và thuật toán Ensemble ML có thể giúp người dùng giảm thời gian trong việc testing bằng cách kết hợp các mô hình này với nhau. Theo <span class="citation" data-cites="cuongsai2020">(<a href="#ref-cuongsai2020" role="doc-biblioref">Cuong Sai 2020</a>)</span>,“Ý tưởng của việc combine các mô hình khác nhau xuất phát từ một suy nghĩ hợp lý là: các mô hình khác nhau có khả năng khác nhau, có thể thực hiện tốt nhất các loại công việc khác nhau (subtasks), khi kết hợp các mô hình này với nhau một cách hợp lý thì sẽ tạo thành một mô hình kết hợp (combined model) mạnh có khả năng cải thiện hiệu suât tổng thể (overall performance) so với việc chỉ dùng các mô hình một cách đơn lẻ.”</p>
<p>Thuật toán Ensemble ML chia thành 3 loại:</p>
<ul>
<li>Bagging: chia bộ dữ liệu thành subsamples và xây dựng thành model cùng kiểu với nhau để đưa ra dự đoán.</li>
<li>Boosting: cũng chia dữ liệu thành subsamples nhưng việc xây dựng mô hình không diễn ra cùng lúc như bagging mà là theo chuỗi nối tiếp nhau.</li>
</ul>
<p>Bạn có thể tưởng tượng như hình dưới đây:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/Bagging_Boosting.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Hình 6: Bagging vs Boosting method.</figcaption>
</figure>
</div>
<ul>
<li>Stacking xây dựng các mô hình khác loại từ training data và một mô hình supervisor model. Sau đó, mô hình này sẽ kết hợp các kết quả dự báo để tìm ra mô hình tốt nhất.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/Staking.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Hình 7: Staking method.</figcaption>
</figure>
</div>
<p>Vậy tiếp theo, chúng ta sẽ thử dùng Ensemble ML trong R để dự đoán.</p>
</section>
<section id="so-sánh-với-mô-hình-arima" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="so-sánh-với-mô-hình-arima"><span class="header-section-number">1.3</span> So sánh với mô hình ARIMA:</h3>
<p>Machine Learning làm tốt về mặt performance ở các vấn đề như: phân loại nhãn (Classification), tự học và bổ sung (AI), phân tích lớp ảnh (Neural network),… nhưng ở lĩnh vực dự đoán chuỗi thời gian (Time series forecast), ML lại không tốt bằng các phương pháp thống kê truyền thống.</p>
</section>
</section>
<section id="thực-hành-trong-r" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="thực-hành-trong-r"><span class="header-section-number">2</span> Thực hành trong R:</h2>
<section id="chuẩn-bị-dữ-liệu" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="chuẩn-bị-dữ-liệu"><span class="header-section-number">2.1</span> Chuẩn bị dữ liệu:</h3>
<p>Bạn có thể quay lại trang đầu tiên để lấy dữ liệu gốc và các bước để chỉnh sửa dữ liệu ở <a href="./index.html">Giới thiệu</a>.</p>
<p>Trong phần này, đối với Machine Learning, ta nên chia bộ dữ liệu thành 3 bộ: training, testing và forecasting dataset. Ngoài ra, ML cần dữ liệu lớn nên ta sẽ tính theo tuần chứ không theo tháng như các phần trước.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sum by daily and remove negative value:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>weekly_df<span class="ot">&lt;-</span>product_demand <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Warehouse,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>           Date,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>           Order_Demand)) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">order_date =</span> <span class="fu">floor_date</span>(Date, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">unit =</span> <span class="st">'week'</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># setting up week commencing Monday</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">week_start =</span> <span class="fu">getOption</span>(<span class="st">"lubridate.week.start"</span>, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(order_date) <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Order_Demand =</span> <span class="fu">sum</span>(Order_Demand)) <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="dygraphs html-widget html-fill-item" id="htmlwidget-e84193cb2f4a831e2905" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e84193cb2f4a831e2905">{"x":{"attrs":{"title":"Training and testing data","ylabel":"Quantity order (Unit: Millions)","labels":["week","Training data","Testing data","Forecasting data"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60,"drawAxis":true},"y":{"drawAxis":true}},"series":{"Training data":{"axis":"y"},"Testing data":{"axis":"y"},"Forecasting data":{"axis":"y"}},"stackedGraph":false,"fillGraph":true,"fillAlpha":0.4,"stepPlot":false,"drawPoints":false,"pointSize":1,"drawGapEdgePoints":false,"connectSeparatedPoints":false,"strokeWidth":1,"strokeBorderColor":"white","colorValue":0.5,"colorSaturation":1,"includeZero":false,"drawAxesAtZero":false,"logscale":false,"axisTickSize":3,"axisLineColor":"black","axisLineWidth":0.3,"axisLabelColor":"black","axisLabelFontSize":14,"axisLabelWidth":60,"drawGrid":true,"gridLineWidth":0.3,"rightGap":5,"digitsAfterDecimal":2,"labelsKMB":false,"labelsKMG2":false,"labelsUTC":false,"maxNumberWidth":6,"animatedZooms":false,"mobileDisableYTouch":true,"disableZoom":false,"showRangeSelector":true,"rangeSelectorHeight":20,"rangeSelectorPlotFillColor":" #A7B1C4","rangeSelectorPlotStrokeColor":"#808FAB","interactionModel":"Dygraph.Interaction.defaultModel"},"scale":"weekly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2011-12-26T00:00:00.000Z","2012-01-02T00:00:00.000Z","2012-01-09T00:00:00.000Z","2012-01-16T00:00:00.000Z","2012-01-23T00:00:00.000Z","2012-01-30T00:00:00.000Z","2012-02-06T00:00:00.000Z","2012-02-13T00:00:00.000Z","2012-02-20T00:00:00.000Z","2012-02-27T00:00:00.000Z","2012-03-05T00:00:00.000Z","2012-03-12T00:00:00.000Z","2012-03-19T00:00:00.000Z","2012-03-26T00:00:00.000Z","2012-04-02T00:00:00.000Z","2012-04-09T00:00:00.000Z","2012-04-16T00:00:00.000Z","2012-04-23T00:00:00.000Z","2012-04-30T00:00:00.000Z","2012-05-07T00:00:00.000Z","2012-05-14T00:00:00.000Z","2012-05-21T00:00:00.000Z","2012-05-28T00:00:00.000Z","2012-06-04T00:00:00.000Z","2012-06-11T00:00:00.000Z","2012-06-18T00:00:00.000Z","2012-06-25T00:00:00.000Z","2012-07-02T00:00:00.000Z","2012-07-09T00:00:00.000Z","2012-07-16T00:00:00.000Z","2012-07-23T00:00:00.000Z","2012-07-30T00:00:00.000Z","2012-08-06T00:00:00.000Z","2012-08-13T00:00:00.000Z","2012-08-20T00:00:00.000Z","2012-08-27T00:00:00.000Z","2012-09-03T00:00:00.000Z","2012-09-10T00:00:00.000Z","2012-09-17T00:00:00.000Z","2012-09-24T00:00:00.000Z","2012-10-01T00:00:00.000Z","2012-10-08T00:00:00.000Z","2012-10-15T00:00:00.000Z","2012-10-22T00:00:00.000Z","2012-10-29T00:00:00.000Z","2012-11-05T00:00:00.000Z","2012-11-12T00:00:00.000Z","2012-11-19T00:00:00.000Z","2012-11-26T00:00:00.000Z","2012-12-03T00:00:00.000Z","2012-12-10T00:00:00.000Z","2012-12-17T00:00:00.000Z","2012-12-24T00:00:00.000Z","2012-12-31T00:00:00.000Z","2013-01-07T00:00:00.000Z","2013-01-14T00:00:00.000Z","2013-01-21T00:00:00.000Z","2013-01-28T00:00:00.000Z","2013-02-04T00:00:00.000Z","2013-02-11T00:00:00.000Z","2013-02-18T00:00:00.000Z","2013-02-25T00:00:00.000Z","2013-03-04T00:00:00.000Z","2013-03-11T00:00:00.000Z","2013-03-18T00:00:00.000Z","2013-03-25T00:00:00.000Z","2013-04-01T00:00:00.000Z","2013-04-08T00:00:00.000Z","2013-04-15T00:00:00.000Z","2013-04-22T00:00:00.000Z","2013-04-29T00:00:00.000Z","2013-05-06T00:00:00.000Z","2013-05-13T00:00:00.000Z","2013-05-20T00:00:00.000Z","2013-05-27T00:00:00.000Z","2013-06-03T00:00:00.000Z","2013-06-10T00:00:00.000Z","2013-06-17T00:00:00.000Z","2013-06-24T00:00:00.000Z","2013-07-01T00:00:00.000Z","2013-07-08T00:00:00.000Z","2013-07-15T00:00:00.000Z","2013-07-22T00:00:00.000Z","2013-07-29T00:00:00.000Z","2013-08-05T00:00:00.000Z","2013-08-12T00:00:00.000Z","2013-08-19T00:00:00.000Z","2013-08-26T00:00:00.000Z","2013-09-02T00:00:00.000Z","2013-09-09T00:00:00.000Z","2013-09-16T00:00:00.000Z","2013-09-23T00:00:00.000Z","2013-09-30T00:00:00.000Z","2013-10-07T00:00:00.000Z","2013-10-14T00:00:00.000Z","2013-10-21T00:00:00.000Z","2013-10-28T00:00:00.000Z","2013-11-04T00:00:00.000Z","2013-11-11T00:00:00.000Z","2013-11-18T00:00:00.000Z","2013-11-25T00:00:00.000Z","2013-12-02T00:00:00.000Z","2013-12-09T00:00:00.000Z","2013-12-16T00:00:00.000Z","2013-12-23T00:00:00.000Z","2013-12-30T00:00:00.000Z","2014-01-06T00:00:00.000Z","2014-01-13T00:00:00.000Z","2014-01-20T00:00:00.000Z","2014-01-27T00:00:00.000Z","2014-02-03T00:00:00.000Z","2014-02-10T00:00:00.000Z","2014-02-17T00:00:00.000Z","2014-02-24T00:00:00.000Z","2014-03-03T00:00:00.000Z","2014-03-10T00:00:00.000Z","2014-03-17T00:00:00.000Z","2014-03-24T00:00:00.000Z","2014-03-31T00:00:00.000Z","2014-04-07T00:00:00.000Z","2014-04-14T00:00:00.000Z","2014-04-21T00:00:00.000Z","2014-04-28T00:00:00.000Z","2014-05-05T00:00:00.000Z","2014-05-12T00:00:00.000Z","2014-05-19T00:00:00.000Z","2014-05-26T00:00:00.000Z","2014-06-02T00:00:00.000Z","2014-06-09T00:00:00.000Z","2014-06-16T00:00:00.000Z","2014-06-23T00:00:00.000Z","2014-06-30T00:00:00.000Z","2014-07-07T00:00:00.000Z","2014-07-14T00:00:00.000Z","2014-07-21T00:00:00.000Z","2014-07-28T00:00:00.000Z","2014-08-04T00:00:00.000Z","2014-08-11T00:00:00.000Z","2014-08-18T00:00:00.000Z","2014-08-25T00:00:00.000Z","2014-09-01T00:00:00.000Z","2014-09-08T00:00:00.000Z","2014-09-15T00:00:00.000Z","2014-09-22T00:00:00.000Z","2014-09-29T00:00:00.000Z","2014-10-06T00:00:00.000Z","2014-10-13T00:00:00.000Z","2014-10-20T00:00:00.000Z","2014-10-27T00:00:00.000Z","2014-11-03T00:00:00.000Z","2014-11-10T00:00:00.000Z","2014-11-17T00:00:00.000Z","2014-11-24T00:00:00.000Z","2014-12-01T00:00:00.000Z","2014-12-08T00:00:00.000Z","2014-12-15T00:00:00.000Z","2014-12-22T00:00:00.000Z","2014-12-29T00:00:00.000Z","2015-01-05T00:00:00.000Z","2015-01-12T00:00:00.000Z","2015-01-19T00:00:00.000Z","2015-01-26T00:00:00.000Z","2015-02-02T00:00:00.000Z","2015-02-09T00:00:00.000Z","2015-02-16T00:00:00.000Z","2015-02-23T00:00:00.000Z","2015-03-02T00:00:00.000Z","2015-03-09T00:00:00.000Z","2015-03-16T00:00:00.000Z","2015-03-23T00:00:00.000Z","2015-03-30T00:00:00.000Z","2015-04-06T00:00:00.000Z","2015-04-13T00:00:00.000Z","2015-04-20T00:00:00.000Z","2015-04-27T00:00:00.000Z","2015-05-04T00:00:00.000Z","2015-05-11T00:00:00.000Z","2015-05-18T00:00:00.000Z","2015-05-25T00:00:00.000Z","2015-06-01T00:00:00.000Z","2015-06-08T00:00:00.000Z","2015-06-15T00:00:00.000Z","2015-06-22T00:00:00.000Z","2015-06-29T00:00:00.000Z","2015-07-06T00:00:00.000Z","2015-07-13T00:00:00.000Z","2015-07-20T00:00:00.000Z","2015-07-27T00:00:00.000Z","2015-08-03T00:00:00.000Z","2015-08-10T00:00:00.000Z","2015-08-17T00:00:00.000Z","2015-08-24T00:00:00.000Z","2015-08-31T00:00:00.000Z","2015-09-07T00:00:00.000Z","2015-09-14T00:00:00.000Z","2015-09-21T00:00:00.000Z","2015-09-28T00:00:00.000Z","2015-10-05T00:00:00.000Z","2015-10-12T00:00:00.000Z","2015-10-19T00:00:00.000Z","2015-10-26T00:00:00.000Z","2015-11-02T00:00:00.000Z","2015-11-09T00:00:00.000Z","2015-11-16T00:00:00.000Z","2015-11-23T00:00:00.000Z","2015-11-30T00:00:00.000Z","2015-12-07T00:00:00.000Z","2015-12-14T00:00:00.000Z","2015-12-21T00:00:00.000Z","2015-12-28T00:00:00.000Z","2016-01-04T00:00:00.000Z","2016-01-11T00:00:00.000Z","2016-01-18T00:00:00.000Z","2016-01-25T00:00:00.000Z","2016-02-01T00:00:00.000Z","2016-02-08T00:00:00.000Z","2016-02-15T00:00:00.000Z","2016-02-22T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-07T00:00:00.000Z","2016-03-14T00:00:00.000Z","2016-03-21T00:00:00.000Z","2016-03-28T00:00:00.000Z","2016-04-04T00:00:00.000Z","2016-04-11T00:00:00.000Z","2016-04-18T00:00:00.000Z","2016-04-25T00:00:00.000Z","2016-05-02T00:00:00.000Z","2016-05-09T00:00:00.000Z","2016-05-16T00:00:00.000Z","2016-05-23T00:00:00.000Z","2016-05-30T00:00:00.000Z","2016-06-06T00:00:00.000Z","2016-06-13T00:00:00.000Z","2016-06-20T00:00:00.000Z","2016-06-27T00:00:00.000Z","2016-07-04T00:00:00.000Z","2016-07-11T00:00:00.000Z","2016-07-18T00:00:00.000Z","2016-07-25T00:00:00.000Z","2016-08-01T00:00:00.000Z","2016-08-08T00:00:00.000Z","2016-08-15T00:00:00.000Z","2016-08-22T00:00:00.000Z","2016-08-29T00:00:00.000Z","2016-09-05T00:00:00.000Z","2016-09-12T00:00:00.000Z","2016-09-19T00:00:00.000Z","2016-09-26T00:00:00.000Z","2016-10-03T00:00:00.000Z","2016-10-10T00:00:00.000Z","2016-10-17T00:00:00.000Z","2016-10-24T00:00:00.000Z","2016-10-31T00:00:00.000Z","2016-11-07T00:00:00.000Z","2016-11-14T00:00:00.000Z","2016-11-21T00:00:00.000Z","2016-11-28T00:00:00.000Z","2016-12-05T00:00:00.000Z"],[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,22260761,20150947,21453596,19529205,22285248,19056985,21980971,18509972,9436386,17492016,18638536,21204456,21685416,21138374,17533878,22930540,18893883,17569466,21548747,23918379,22232836,21415405,21795208,22955051,30140283,22499920,22087088,15759501,4953768,30467384,22268989,24411223,24764659,25305676,22765509,21627443,19081624,21835896,24974150,20421281,27335025,26808417,19562645,19216657,22677443,18621449,15332432,19324004,22930695,19897789,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,19127898,21233567,20589686,20836689,30459853,18461206,22368900,19530250,25074235,25023078,9254588,23359538,18513500,26044284,21301254,17467541,12049718,24044104,23481598,19573393,19149451,18440919,18920410,19712992,20172078,16418919,23614306,25133540,17604112,18633142,8576627,21257253,19743800,21399017,15994362,23282872,13853856,15239296,16225127,22228193,18952893,23782946,17878698,20076930,20449466,17734007,19401206,16490121,11904220,21767274,18697574,20149830,19595404,16780492,15077140,18561483,23017389,22377223,18459147,16766401,26459173,21513691,13889835,14654129,18203632,18796217,17923624,15357930,13954638,23371498,17472193,21039841,21118703,21008982,17816031,22004901,19989964,19363613,26390008,21295477]],"fixedtz":false,"tzone":"UTC"},"evals":["attrs.interactionModel"],"jsHooks":[]}</script>
</div>
</div>
<p>Giống ý tưởng của ARIMA, Ensemble ML cũng phân tích mối tương quan giữa giá trị tại thời điểm t với thời điểm t-1, t-2,… Và vì ta đã có dữ liệu tại thời điểm t nên ta cần tính giá trị tại các thời điểm t-1, t-2 bằng hàm <code>lag</code>.</p>
<p>Trong R, có hàm <code>ts_lags</code> để kiếm tra mức độ tương quan giữa biến hiện tại và các biến trong quá khứ. Mặc định, hàm sẽ tính cho ta trong 12 lags nhưng ta có thể chỉ định bằng đối số: <code>lags = c()</code></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSstudio)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts_lags</span>(demand_training, <span class="at">lags =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">26</span>, <span class="dv">39</span>, <span class="dv">52</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-271f84c4e88c2ff10860" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-271f84c4e88c2ff10860">{"x":{"data":[{"x":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123],"y":[21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373],"y":[18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x2","yaxis":"y","frame":null},{"x":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695],"y":[13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663],"y":[13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","type":"scatter","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,0.47999999999999998],"automargin":true,"title":"","range":[2,26285554],"anchor":"y2"},"xaxis2":{"domain":[0.52000000000000002,1],"automargin":true,"title":"","range":[2,26285554],"anchor":"y2"},"yaxis2":{"domain":[0,0.47999999999999998],"automargin":true,"range":[2,26285554],"title":[],"anchor":"x"},"yaxis":{"domain":[0.52000000000000002,1],"automargin":true,"range":[2,26285554],"title":[],"anchor":"x"},"annotations":[{"text":"Lag 13","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.23999999999999999,"y":0.95199999999999996,"showarrow":false},{"text":"Lag 26","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.76000000000000001,"y":0.95199999999999996,"showarrow":false},{"text":"Lag 39","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.23999999999999999,"y":0.432,"showarrow":false},{"text":"Lag 52","xref":"paper","yref":"paper","yanchor":"bottom","xanchor":"center","align":"center","x":0.76000000000000001,"y":0.432,"showarrow":false}],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"closest","showlegend":false,"title":"demand_training - Series (Y axis) vs. Lags (X axis)"},"attrs":{"289023cb6ac6":{"x":[null,null,null,null,null,null,null,null,null,null,null,null,null,2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123],"y":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"289057697985":{"x":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373],"y":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"28907f5f3c34":{"x":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695],"y":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"289030215a67":{"x":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663],"y":[2,17909455,16473029,16400961,13307777,22334970,25026051,18924654,18937289,24535349,22015209,15704557,13831054,21850913,19519711,15629096,18596714,19077898,10727815,23422438,18934757,19389428,18970478,18829732,21471260,19375052,18354275,25660365,17835506,15962066,19675106,20114889,17130335,8246702,19842971,17158744,18427007,16647955,12531465,13683628,20275486,17881212,17795198,17065992,18772356,18558800,14331013,13939283,20724858,20257859,19068021,15982229,13201011,7808429,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,11401048,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,5480766,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,".hideLegend":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Dựa vào biểu đồ trên này, ta thấy được mối quan hệ tuyến tính theo hướng tích cực giữa dữ liệu chuỗi và giá trị của nó ở lag 52 (nghĩa là 1 năm sau) và hướng tiêu cực với giá trị của nó ở lag 13.</p>
<p>Do đó, chúng ta sẽ tạo lại bộ dữ liệu có các biến mới.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  weekly_df <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trend       =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(weekly_df),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">trend_sqr   =</span> trend<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">rev_lag_13  =</span> <span class="fu">lag</span>(Order_Demand, <span class="at">n =</span> <span class="dv">13</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">rev_lag_52  =</span> <span class="fu">lag</span>(Order_Demand, <span class="at">n =</span> <span class="dv">52</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">season      =</span> <span class="fu">case_when</span>(Order_Demand <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rev_lag_52)<span class="sc">&amp;!</span><span class="fu">is.na</span>(rev_lag_13)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">ifelse</span>(order_date <span class="sc">&lt;=</span> n[[<span class="dv">2</span>]],</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"train"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(order_date <span class="sc">&gt;</span> n[[<span class="dv">2</span>]]<span class="sc">&amp;</span> order_date <span class="sc">&lt;=</span> n[[<span class="dv">3</span>]],</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"test"</span>,<span class="st">"forecast"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="xử-lí-missing-value-và-outliers" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="xử-lí-missing-value-và-outliers"><span class="header-section-number">2.2</span> Xử lí missing value và outliers:</h3>
<section id="missing-value" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="missing-value"><span class="header-section-number">2.2.1</span> Missing value:</h4>
<p>Gía trị NA xuất hiện là do ta đang lấy dữ liệu từ quá khứ thời điểm cách 1 tháng, 2 tháng và 3 tháng. Vì Machine Learning bắt buộc phải có đầy đủ giá trị nên ta có thể sử dụng cách khác để tạo ra giá trị thay thế cho NA. Mình kham khảo được cách này từ <span class="citation" data-cites="sauravkaushik8kaushik2019">(<a href="#ref-sauravkaushik8kaushik2019" role="doc-biblioref">Sauravkaushik8 Kaushik 2019</a>)</span>.</p>
</section>
<section id="outliers" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="outliers"><span class="header-section-number">2.2.2</span> Outliers:</h4>
<p>Ngoài ra, vấn đề về <em>outliers</em> cũng cần được quan tâm. <em>Outlier</em> là các giá trị có vẻ “lệch” hoặc không bình thường so với toàn bộ dữ liệu. Nguyên nhân xuất hiện outlier có thể do các biến cố không lường trước hoặc đơn giản là sai sót trong việc đo lường, tính toán của người thu thập dữ liệu.</p>
<p>Vì mục đích của chúng ta là xây dựng mô hình nên các outliers không giúp ích nhiều. Do đó chúng ta cần loại bỏ nó trước khi mô hình hóa.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(model_data,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Order_Demand,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">as.factor</span>(class),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">as.factor</span>(class))) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color=</span><span class="st">"black"</span>, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">size=</span><span class="fl">0.4</span>, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position=</span><span class="st">"none"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">hjust=</span><span class="dv">1</span>, </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">vjust=</span><span class="fl">0.5</span>, </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face=</span><span class="st">'bold'</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"A boxplot with jitter"</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Dataset"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="EnsembleML_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Các điểm đen lạc lỏng ở ngoài vùng boxplot chính là outliers</figcaption>
</figure>
</div>
</div>
<p>Biểu đồ phân bố của 3 bộ dữ liệu</p>
</div>
<p>Cách xử lí outliers khá đơn giản. Ở đây mình sử dụng phương pháp IQR hay còn gọi là tứ phân vị. Sau khi xử lí, bạn có thể chạy lại code trên để kiểm tra xem outliers đã được loại bỏ hay chưa.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://svcuong.github.io/post/remove-outliers/"><img src="img/IQR.png" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Hình 8: IQR method.</figcaption>
</figure>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tính IQR</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>q25 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(model_data<span class="sc">$</span>Order_Demand, <span class="fl">0.25</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>q75 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(model_data<span class="sc">$</span>Order_Demand, <span class="fl">0.75</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>iqr <span class="ot">&lt;-</span> q75 <span class="sc">-</span> q25</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># thiết lập giới hạn để xác định outliers</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>limit_iqr <span class="ot">=</span> <span class="fl">1.5</span><span class="sc">*</span>iqr</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>lower_iqr <span class="ot">=</span> q25 <span class="sc">-</span> limit_iqr</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>upper_iqr <span class="ot">=</span> q75 <span class="sc">+</span> limit_iqr</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loại bỏ các outliers</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> model_data[<span class="sc">-</span><span class="fu">which</span>(model_data<span class="sc">$</span>Order_Demand <span class="sc">&gt;</span> upper_iqr <span class="sc">|</span> model_data<span class="sc">$</span>Order_Demand <span class="sc">&lt;</span> lower_iqr),]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Tạo các bộ dữ liệu training,testing và forecasting:</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  model_data <span class="sc">%&gt;%</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">==</span> <span class="st">"train"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  model_data <span class="sc">%&gt;%</span> </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">==</span> <span class="st">"test"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>forecast_data <span class="ot">&lt;-</span> </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  model_data <span class="sc">%&gt;%</span> </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">==</span> <span class="st">"forecast"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="dự-đoán" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="dự-đoán"><span class="header-section-number">2.3</span> Dự đoán:</h3>
<section id="mô-hình-random-forest" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="mô-hình-random-forest"><span class="header-section-number">2.3.1</span> Mô hình Random Forest:</h4>
<p>Đầu tiên chúng ta sẽ làm việc với thuật toán boosting khá phổ biến là: <em>Random Forest</em>.</p>
<p>Random Forest là một phương pháp học máy thuộc loại ensemble learning, được sử dụng chủ yếu cho các bài toán phân loại và hồi quy. Đây là một kỹ thuật mạnh mẽ và phổ biến, được phát triển bởi Leo Breiman vào năm 2001.</p>
<p>Về ưu Điểm:</p>
<ul>
<li><p>Khả Năng Tổng Quát Cao: Random Forest thường có khả năng tổng quát tốt hơn so với các mô hình cây quyết định đơn lẻ, do giảm thiểu overfitting (quá khớp) nhờ vào sự kết hợp của nhiều cây.</p></li>
<li><p>Khả Năng Xử Lý Dữ Liệu Lớn và Nhiều Đặc Trưng: Random Forest có thể xử lý hiệu quả dữ liệu với số lượng lớn các đặc trưng và quan sát.</p></li>
<li><p>Khả Năng Đánh Giá Tầm Quan Trọng Của Các Đặc Trưng: Random Forest cung cấp thông tin về tầm quan trọng của từng đặc trưng trong việc đưa ra dự đoán, giúp ích trong việc chọn lọc và phân tích đặc trưng.</p></li>
</ul>
<p>Về nhược Điểm:</p>
<ul>
<li><p>Khó Giải Thích: Mặc dù Random Forest có hiệu suất tốt, nhưng các mô hình cây quyết định kết hợp lại có thể khó giải thích và không trực quan bằng các mô hình đơn giản hơn.</p></li>
<li><p>Tốn Tài Nguyên Tính Toán: Đặc biệt khi số lượng cây lớn, Random Forest có thể yêu cầu nhiều tài nguyên tính toán và bộ nhớ.</p></li>
</ul>
<p>Phân tích thêm về mức độ quan trọng của các biến trong mô hình. Ta thấy biến <code>lag_50</code> đóng vai trò quan trọng nhất, đúng như dự đoán của ta khi phân tích ở trên về mối tương quan.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## visualise the variable importance </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rft_model <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h2o.varimp_plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EnsembleML_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pred<span class="ot">&lt;-</span> <span class="fu">h2o.predict</span>(rft_model, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> <span class="fu">as.h2o</span>(train_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actual =</span> train_data<span class="sc">$</span>Order_Demand,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> train_data<span class="sc">$</span>order_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pred <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> date, <span class="at">y =</span> <span class="sc">~</span> actual, <span class="at">name =</span> <span class="st">'Actual'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> date, <span class="at">y =</span> <span class="sc">~</span> predict, <span class="at">name =</span> <span class="st">'Random Forest'</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">line =</span> <span class="fu">list</span>(<span class="at">dash =</span> <span class="st">'dot'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6928036d7b10fad3403c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6928036d7b10fad3403c">{"x":{"visdat":{"289039a27ba1":["function () ","plotlyVisDat"]},"cur_data":"289039a27ba1","attrs":{"289039a27ba1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Actual","inherit":true},"289039a27ba1.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Random Forest","line":{"dash":"dot"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"actual"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2012-12-24","2013-01-07","2013-01-14","2013-01-21","2013-01-28","2013-02-04","2013-02-11","2013-02-18","2013-02-25","2013-03-04","2013-03-11","2013-03-18","2013-03-25","2013-04-01","2013-04-08","2013-04-15","2013-04-22","2013-04-29","2013-05-06","2013-05-13","2013-05-20","2013-05-27","2013-06-03","2013-06-10","2013-06-17","2013-06-24","2013-07-01","2013-07-08","2013-07-15","2013-07-22","2013-07-29","2013-08-05","2013-08-19","2013-08-26","2013-09-02","2013-09-09","2013-09-16","2013-09-23","2013-09-30","2013-10-07","2013-10-14","2013-10-21","2013-10-28","2013-11-04","2013-11-11","2013-11-18","2013-11-25","2013-12-02","2013-12-09","2013-12-16","2013-12-23","2014-01-06","2014-01-13","2014-01-20","2014-01-27","2014-02-03","2014-02-10","2014-02-17","2014-02-24","2014-03-03","2014-03-10","2014-03-17","2014-03-24","2014-03-31","2014-04-07","2014-04-14","2014-04-21","2014-04-28","2014-05-05","2014-05-12","2014-05-19","2014-05-26","2014-06-02","2014-06-09"],"y":[13201011,23058233,19183893,20353275,21368632,22333482,13063616,17153878,18483639,21839189,21996083,16203490,17169741,23186612,16817513,18480400,21593406,13411217,18412483,19368455,17213664,20123124,21278299,19246663,16255037,20118451,18806675,16213318,18465339,21644654,22471327,17759719,21537180,17892180,24615927,18368695,14872029,18088371,23108356,26285554,16346812,22093995,22127574,20275281,22544920,22876760,22445421,22389284,19197373,22631021,18249417,25416676,19840243,23104932,16071115,18981931,21536411,22143846,19618711,21835044,21553123,24005824,22010853,25066557,20177173,20921399,18892115,19743795,15277995,21401582,22255569,17590059,23073327,21367839],"type":"scatter","mode":"lines","name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2012-12-24","2013-01-07","2013-01-14","2013-01-21","2013-01-28","2013-02-04","2013-02-11","2013-02-18","2013-02-25","2013-03-04","2013-03-11","2013-03-18","2013-03-25","2013-04-01","2013-04-08","2013-04-15","2013-04-22","2013-04-29","2013-05-06","2013-05-13","2013-05-20","2013-05-27","2013-06-03","2013-06-10","2013-06-17","2013-06-24","2013-07-01","2013-07-08","2013-07-15","2013-07-22","2013-07-29","2013-08-05","2013-08-19","2013-08-26","2013-09-02","2013-09-09","2013-09-16","2013-09-23","2013-09-30","2013-10-07","2013-10-14","2013-10-21","2013-10-28","2013-11-04","2013-11-11","2013-11-18","2013-11-25","2013-12-02","2013-12-09","2013-12-16","2013-12-23","2014-01-06","2014-01-13","2014-01-20","2014-01-27","2014-02-03","2014-02-10","2014-02-17","2014-02-24","2014-03-03","2014-03-10","2014-03-17","2014-03-24","2014-03-31","2014-04-07","2014-04-14","2014-04-21","2014-04-28","2014-05-05","2014-05-12","2014-05-19","2014-05-26","2014-06-02","2014-06-09"],"y":[13936235.035714285,21496675.321428571,20162624.928571429,19425744.964285713,20903450.571428571,20762180.071428571,15867451.142857144,16997758.857142858,19482851.428571429,21171522.714285713,21148321.357142858,17227830.928571429,19134775.857142858,20745601.392857142,18599455.678571429,19644217.285714287,20694964.714285713,15191736.5,18882269.535714287,18892036.214285713,18347706.607142858,19940857.285714287,20895250.357142858,19572478.535714287,17515061,19127387.642857142,19413379.071428571,17539139.392857142,18986451.714285713,21308615.857142858,20936029.25,18426739,20817984.928571429,19403034.428571429,22142670.857142858,19087497.607142858,15809481.571428571,18418620.035714287,22616840.571428571,23654882.857142858,19845889.5,21570779.142857142,21844120.714285713,20791880.357142858,22069863,22476604.285714287,21884360.142857142,22381365.714285713,20387404.428571429,22066419.857142858,19765342.857142858,24184317.857142858,20346316.928571429,21709989.035714287,18149772.642857142,19552691.464285713,21594271.214285713,22038714.428571429,20520842.428571429,21123273.392857142,21004134.857142858,23200947.928571429,21603276.464285713,24291855.392857142,20717392.821428571,20000026.285714287,19680130.75,19226590.821428571,16457737.214285715,21274155.285714287,21484028.142857142,18903876.142857142,21913223.285714287,21660187.214285713],"type":"scatter","mode":"lines","name":"Random Forest","line":{"color":"rgba(255,127,14,1)","dash":"dot"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Khi dùng dữ liệu của bộ Training data, ML dự đoán lại gần như sát với dữ liệu thực tế. Nhưng khi có dữ liệu mới vào Machine Learning không dự đoán tốt được. Ví dụ như dưới đây.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_f</span>(rft_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-6631b225f57c7c31be42" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6631b225f57c7c31be42">{"x":{"visdat":{"289031862a88":["function () ","plotlyVisDat"]},"cur_data":"289031862a88","attrs":{"289031862a88":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Actual value of Testing","line":{"width":3},"inherit":true},"289031862a88.1":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Predicted value of Testing","line":{"dash":"dot","width":4},"inherit":true},"289031862a88.2":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Actual of Forecasting","line":{"width":3},"inherit":true},"289031862a88.3":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Predicted of Forecasting","line":{"dash":"dot","width":4},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Evaluating the model's forecasting result","yaxis":{"domain":[0,1],"automargin":true,"title":"Order Demand"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Time"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"lines","x":["2014-06-16","2014-06-23","2014-06-30","2014-07-07","2014-07-14","2014-07-21","2014-07-28","2014-08-04","2014-08-18","2014-08-25","2014-09-01","2014-09-08","2014-09-15","2014-09-22","2014-09-29","2014-10-06","2014-10-13","2014-10-20","2014-10-27","2014-11-03","2014-11-10","2014-11-17","2014-11-24","2014-12-08","2014-12-15","2014-12-22","2015-01-12","2015-01-19","2015-01-26","2015-02-02","2015-02-09","2015-02-16","2015-02-23","2015-03-02","2015-03-09","2015-03-16","2015-03-23","2015-03-30","2015-04-06","2015-04-13","2015-04-20","2015-04-27","2015-05-04","2015-05-11","2015-05-18","2015-05-25"],"y":[22260761,20150947,21453596,19529205,22285248,19056985,21980971,18509972,17492016,18638536,21204456,21685416,21138374,17533878,22930540,18893883,17569466,21548747,23918379,22232836,21415405,21795208,22955051,22499920,22087088,15759501,22268989,24411223,24764659,25305676,22765509,21627443,19081624,21835896,24974150,20421281,27335025,26808417,19562645,19216657,22677443,18621449,15332432,19324004,22930695,19897789],"name":"Actual value of Testing","line":{"color":"rgba(31,119,180,1)","width":3},"type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2014-06-16","2014-06-23","2014-06-30","2014-07-07","2014-07-14","2014-07-21","2014-07-28","2014-08-04","2014-08-18","2014-08-25","2014-09-01","2014-09-08","2014-09-15","2014-09-22","2014-09-29","2014-10-06","2014-10-13","2014-10-20","2014-10-27","2014-11-03","2014-11-10","2014-11-17","2014-11-24","2014-12-08","2014-12-15","2014-12-22","2015-01-12","2015-01-19","2015-01-26","2015-02-02","2015-02-09","2015-02-16","2015-02-23","2015-03-02","2015-03-09","2015-03-16","2015-03-23","2015-03-30","2015-04-06","2015-04-13","2015-04-20","2015-04-27","2015-05-04","2015-05-11","2015-05-18","2015-05-25"],"y":[21974531.357142858,21514665.214285713,21896986.928571429,20648311.035714287,20712537.571428571,19134431.964285713,20170809,19999041.678571429,20944007.678571429,19534011.678571429,22303881.285714287,20845899.714285713,22113971.571428571,20380261.142857142,22375614.142857142,21325680,22113971.571428571,19141049.25,21394227.285714287,19355897.571428571,20562263.892857142,20898475.178571429,19700227,21660187.214285713,21485240.571428571,19534011.678571429,19294987.285714287,22375614.142857142,22111268.928571429,21471958.75,21053618.714285713,21394227.285714287,21572708.785714287,22177591.428571429,21044757.714285713,22436524.428571429,19590502.25,21796599.5,22176959.928571429,21499455.535714287,21410061.642857142,21606260.214285713,21977745.214285713,21343415.714285713,21333317,19694001.428571429],"name":"Predicted value of Testing","line":{"color":"rgba(255,127,14,1)","dash":"dot","width":4},"type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2015-06-01","2015-06-08","2015-06-15","2015-06-22","2015-07-06","2015-07-13","2015-07-20","2015-07-27","2015-08-03","2015-08-17","2015-08-24","2015-08-31","2015-09-07","2015-09-14","2015-09-21","2015-09-28","2015-10-05","2015-10-12","2015-10-19","2015-10-26","2015-11-02","2015-11-09","2015-11-16","2015-11-23","2015-11-30","2015-12-07","2015-12-14","2015-12-21","2016-01-04","2016-01-11","2016-01-18","2016-01-25","2016-02-01","2016-02-08","2016-02-15","2016-02-22","2016-02-29","2016-03-07","2016-03-14","2016-03-21","2016-03-28","2016-04-04","2016-04-11","2016-04-18","2016-04-25","2016-05-02","2016-05-09","2016-05-16","2016-05-23","2016-05-30","2016-06-06","2016-06-13","2016-06-20","2016-06-27","2016-07-04","2016-07-11","2016-07-18","2016-07-25","2016-08-01","2016-08-08","2016-08-15","2016-08-22","2016-08-29","2016-09-05","2016-09-12","2016-09-19","2016-09-26","2016-10-03","2016-10-10","2016-10-17","2016-10-24","2016-10-31","2016-11-07","2016-11-14","2016-11-21","2016-11-28","2016-12-05","2016-12-12","2016-12-19"],"y":[19127898,21233567,20589686,20836689,18461206,22368900,19530250,25074235,25023078,23359538,18513500,26044284,21301254,17467541,12049718,24044104,23481598,19573393,19149451,18440919,18920410,19712992,20172078,16418919,23614306,25133540,17604112,18633142,21257253,19743800,21399017,15994362,23282872,13853856,15239296,16225127,22228193,18952893,23782946,17878698,20076930,20449466,17734007,19401206,16490121,11904220,21767274,18697574,20149830,19595404,16780492,15077140,18561483,23017389,22377223,18459147,16766401,26459173,21513691,13889835,14654129,18203632,18796217,17923624,15357930,13954638,23371498,17472193,21039841,21118703,21008982,17816031,22004901,19989964,19363613,26390008,21295477,19918175,17474312],"name":"Actual of Forecasting","line":{"color":"rgba(44,160,44,1)","width":3},"type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2015-06-01","2015-06-08","2015-06-15","2015-06-22","2015-07-06","2015-07-13","2015-07-20","2015-07-27","2015-08-03","2015-08-17","2015-08-24","2015-08-31","2015-09-07","2015-09-14","2015-09-21","2015-09-28","2015-10-05","2015-10-12","2015-10-19","2015-10-26","2015-11-02","2015-11-09","2015-11-16","2015-11-23","2015-11-30","2015-12-07","2015-12-14","2015-12-21","2016-01-04","2016-01-11","2016-01-18","2016-01-25","2016-02-01","2016-02-08","2016-02-15","2016-02-22","2016-02-29","2016-03-07","2016-03-14","2016-03-21","2016-03-28","2016-04-04","2016-04-11","2016-04-18","2016-04-25","2016-05-02","2016-05-09","2016-05-16","2016-05-23","2016-05-30","2016-06-06","2016-06-13","2016-06-20","2016-06-27","2016-07-04","2016-07-11","2016-07-18","2016-07-25","2016-08-01","2016-08-08","2016-08-15","2016-08-22","2016-08-29","2016-09-05","2016-09-12","2016-09-19","2016-09-26","2016-10-03","2016-10-10","2016-10-17","2016-10-24","2016-10-31","2016-11-07","2016-11-14","2016-11-21","2016-11-28","2016-12-05","2016-12-12","2016-12-19"],"y":[22436524.428571429,21721037,20222038.714285713,22176959.928571429,19900600,19365161,21572708.785714287,19420705,19972909.678571429,21950352.214285713,20204628.5,19657201.714285713,21053618.714285713,20649000.142857142,20886284.464285713,23077723,19300026.928571429,21950352.214285713,19884669.714285713,22664816.714285713,21622519.571428571,20362503.178571429,21271652.714285713,20898475.178571429,23077723,21143927,19381508.428571429,20214340.571428571,22303881.285714287,19891287,20882127.75,20898475.178571429,20658016,21325680,20080500.714285713,19282129.714285713,21271652.714285713,22664816.714285713,19416807.857142858,20937671.75,21796599.5,21069116.071428571,19867871.642857142,21485240.571428571,19710046.464285713,22111268.928571429,19821953.928571429,21284413.357142858,19564891.392857142,21471958.75,19433089.964285713,21330261.071428571,19477718.142857142,21325680,20339549.214285713,19661030.428571429,19900600,20947976.107142858,21519517.5,19047602.928571429,20937671.75,20204628.5,21325680,19723050.071428571,20181499.285714287,16833280.75,22392300,22392300,19451731.714285713,19282129.714285713,22396095.357142858,21661392.285714287,19827754.607142858,19827754.607142858,20097410.607142858,20937671.75,20898475.178571429,20239500.857142858,19972909.678571429],"name":"Predicted of Forecasting","line":{"color":"rgba(214,39,40,1)","dash":"dot","width":4},"type":"scatter","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="mô-hình-glm" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="mô-hình-glm"><span class="header-section-number">2.3.2</span> Mô hình GLM:</h4>
<p>Chúng ta thử thêm 1 số mô hình khác của ML. Ở dưới đây là mô hình <strong>Geleralised linear model</strong> sử dụng phương pháp OSL để tính toán.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_f</span>(glm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-c62b781cc60bc9d10ab9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c62b781cc60bc9d10ab9">{"x":{"visdat":{"2890578731a7":["function () ","plotlyVisDat"]},"cur_data":"2890578731a7","attrs":{"2890578731a7":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Actual value of Testing","line":{"width":3},"inherit":true},"2890578731a7.1":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Predicted value of Testing","line":{"dash":"dot","width":4},"inherit":true},"2890578731a7.2":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Actual of Forecasting","line":{"width":3},"inherit":true},"2890578731a7.3":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Predicted of Forecasting","line":{"dash":"dot","width":4},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Evaluating the model's forecasting result","yaxis":{"domain":[0,1],"automargin":true,"title":"Order Demand"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Time"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"lines","x":["2014-06-16","2014-06-23","2014-06-30","2014-07-07","2014-07-14","2014-07-21","2014-07-28","2014-08-04","2014-08-18","2014-08-25","2014-09-01","2014-09-08","2014-09-15","2014-09-22","2014-09-29","2014-10-06","2014-10-13","2014-10-20","2014-10-27","2014-11-03","2014-11-10","2014-11-17","2014-11-24","2014-12-08","2014-12-15","2014-12-22","2015-01-12","2015-01-19","2015-01-26","2015-02-02","2015-02-09","2015-02-16","2015-02-23","2015-03-02","2015-03-09","2015-03-16","2015-03-23","2015-03-30","2015-04-06","2015-04-13","2015-04-20","2015-04-27","2015-05-04","2015-05-11","2015-05-18","2015-05-25"],"y":[22260761,20150947,21453596,19529205,22285248,19056985,21980971,18509972,17492016,18638536,21204456,21685416,21138374,17533878,22930540,18893883,17569466,21548747,23918379,22232836,21415405,21795208,22955051,22499920,22087088,15759501,22268989,24411223,24764659,25305676,22765509,21627443,19081624,21835896,24974150,20421281,27335025,26808417,19562645,19216657,22677443,18621449,15332432,19324004,22930695,19897789],"name":"Actual value of Testing","line":{"color":"rgba(31,119,180,1)","width":3},"type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2014-06-16","2014-06-23","2014-06-30","2014-07-07","2014-07-14","2014-07-21","2014-07-28","2014-08-04","2014-08-18","2014-08-25","2014-09-01","2014-09-08","2014-09-15","2014-09-22","2014-09-29","2014-10-06","2014-10-13","2014-10-20","2014-10-27","2014-11-03","2014-11-10","2014-11-17","2014-11-24","2014-12-08","2014-12-15","2014-12-22","2015-01-12","2015-01-19","2015-01-26","2015-02-02","2015-02-09","2015-02-16","2015-02-23","2015-03-02","2015-03-09","2015-03-16","2015-03-23","2015-03-30","2015-04-06","2015-04-13","2015-04-20","2015-04-27","2015-05-04","2015-05-11","2015-05-18","2015-05-25"],"y":[20055524.540916502,20055533.590802327,20055532.975605626,20055524.973121352,20055531.657782927,20055539.063462995,20055542.395315379,20055529.557453692,20055544.201087803,20055533.824588224,20055553.8370625,20055538.834854718,20055531.845917799,20055539.331143457,20055553.000666421,20055560.500417825,20055539.087111078,20055552.050448932,20055554.655815851,20055549.266709242,20055550.724098559,20055556.844742589,20055557.384462193,20055553.163426604,20055562.065030709,20055550.563369073,20055557.321526289,20055568.296479501,20055553.698487561,20055560.754220147,20055567.430775821,20055570.091490906,20055565.666058265,20055575.891411323,20055572.072504833,20055578.74393858,20055571.53706922,20055574.015376739,20055577.175058316,20055575.533427466,20055572.861806687,20055576.132366039,20055566.754097838,20055581.105305351,20055583.582461406,20055572.059376694],"name":"Predicted value of Testing","line":{"color":"rgba(255,127,14,1)","dash":"dot","width":4},"type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2015-06-01","2015-06-08","2015-06-15","2015-06-22","2015-07-06","2015-07-13","2015-07-20","2015-07-27","2015-08-03","2015-08-17","2015-08-24","2015-08-31","2015-09-07","2015-09-14","2015-09-21","2015-09-28","2015-10-05","2015-10-12","2015-10-19","2015-10-26","2015-11-02","2015-11-09","2015-11-16","2015-11-23","2015-11-30","2015-12-07","2015-12-14","2015-12-21","2016-01-04","2016-01-11","2016-01-18","2016-01-25","2016-02-01","2016-02-08","2016-02-15","2016-02-22","2016-02-29","2016-03-07","2016-03-14","2016-03-21","2016-03-28","2016-04-04","2016-04-11","2016-04-18","2016-04-25","2016-05-02","2016-05-09","2016-05-16","2016-05-23","2016-05-30","2016-06-06","2016-06-13","2016-06-20","2016-06-27","2016-07-04","2016-07-11","2016-07-18","2016-07-25","2016-08-01","2016-08-08","2016-08-15","2016-08-22","2016-08-29","2016-09-05","2016-09-12","2016-09-19","2016-09-26","2016-10-03","2016-10-10","2016-10-17","2016-10-24","2016-10-31","2016-11-07","2016-11-14","2016-11-21","2016-11-28","2016-12-05","2016-12-12","2016-12-19"],"y":[19127898,21233567,20589686,20836689,18461206,22368900,19530250,25074235,25023078,23359538,18513500,26044284,21301254,17467541,12049718,24044104,23481598,19573393,19149451,18440919,18920410,19712992,20172078,16418919,23614306,25133540,17604112,18633142,21257253,19743800,21399017,15994362,23282872,13853856,15239296,16225127,22228193,18952893,23782946,17878698,20076930,20449466,17734007,19401206,16490121,11904220,21767274,18697574,20149830,19595404,16780492,15077140,18561483,23017389,22377223,18459147,16766401,26459173,21513691,13889835,14654129,18203632,18796217,17923624,15357930,13954638,23371498,17472193,21039841,21118703,21008982,17816031,22004901,19989964,19363613,26390008,21295477,19918175,17474312],"name":"Actual of Forecasting","line":{"color":"rgba(44,160,44,1)","width":3},"type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2015-06-01","2015-06-08","2015-06-15","2015-06-22","2015-07-06","2015-07-13","2015-07-20","2015-07-27","2015-08-03","2015-08-17","2015-08-24","2015-08-31","2015-09-07","2015-09-14","2015-09-21","2015-09-28","2015-10-05","2015-10-12","2015-10-19","2015-10-26","2015-11-02","2015-11-09","2015-11-16","2015-11-23","2015-11-30","2015-12-07","2015-12-14","2015-12-21","2016-01-04","2016-01-11","2016-01-18","2016-01-25","2016-02-01","2016-02-08","2016-02-15","2016-02-22","2016-02-29","2016-03-07","2016-03-14","2016-03-21","2016-03-28","2016-04-04","2016-04-11","2016-04-18","2016-04-25","2016-05-02","2016-05-09","2016-05-16","2016-05-23","2016-05-30","2016-06-06","2016-06-13","2016-06-20","2016-06-27","2016-07-04","2016-07-11","2016-07-18","2016-07-25","2016-08-01","2016-08-08","2016-08-15","2016-08-22","2016-08-29","2016-09-05","2016-09-12","2016-09-19","2016-09-26","2016-10-03","2016-10-10","2016-10-17","2016-10-24","2016-10-31","2016-11-07","2016-11-14","2016-11-21","2016-11-28","2016-12-05","2016-12-12","2016-12-19"],"y":[20055587.763027113,20055586.43609795,20055587.166480497,20055586.928871144,20055583.358429253,20055590.858931135,20055586.077697951,20055591.972798817,20055582.949377749,20055586.826461591,20055589.029347774,20055595.870307963,20055599.276570063,20055598.726868231,20055591.331422012,20055610.624815922,20055595.546560824,20055595.620741546,20055604.754539229,20055614.586091079,20055611.654456098,20055602.268634908,20055611.990598645,20055613.290063065,20055635.771105696,20055616.025903139,20055614.114687134,20055597.15933213,20055640.99299128,20055620.382062428,20055626.471383799,20055628.119263463,20055630.866442636,20055626.397004489,20055625.113287598,20055618.167949885,20055629.888401572,20055639.449474428,20055625.64959278,20055644.007914532,20055638.500009179,20055629.233869664,20055628.808886763,20055639.240471262,20055627.809926327,20055625.119946312,20055630.813368808,20055641.46366382,20055635.974822327,20055638.64411512,20055643.173039738,20055645.514869392,20055644.164750632,20055669.710883088,20055642.40643299,20055651.581081148,20055646.959075298,20055659.959922474,20055658.63397238,20055627.46311963,20055660.923732609,20055651.389144436,20055670.45524887,20055658.856762044,20055650.047193736,20055640.260611955,20055672.770956367,20055672.39694985,20055662.220624033,20055661.614705943,20055666.516516227,20055666.317819718,20055665.418599218,20055668.281128753,20055662.557329588,20055681.492012233,20055686.019493874,20055667.92657933,20055670.997550357],"name":"Predicted of Forecasting","line":{"color":"rgba(214,39,40,1)","dash":"dot","width":4},"type":"scatter","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="mô-hình-auto-ml" class="level4" data-number="2.3.3">
<h4 data-number="2.3.3" class="anchored" data-anchor-id="mô-hình-auto-ml"><span class="header-section-number">2.3.3</span> Mô hình Auto ML:</h4>
<p>Trong gói package <strong>{h2o}</strong> của R có mô hình “Auto Machine Learning” (AutoML) có thể tự động hóa quy trình đào tạo mô hình học máy được giám sát (supervised ML). AutoML tìm thấy mô hình tốt nhất, đưa ra khung đào tạo và phản hồi, đồng thời trả về đối tượng H2OAutoML, chứa bảng xếp hạng gồm tất cả các mô hình đã được đào tạo trong quy trình, được xếp hạng theo chỉ số hiệu suất mô hình mặc định.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_f</span>(automl_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter
No trace type specified:
  Based on info supplied, a 'scatter' trace seems appropriate.
  Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-cb11360b61fab453bedc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cb11360b61fab453bedc">{"x":{"visdat":{"2890601454aa":["function () ","plotlyVisDat"]},"cur_data":"2890601454aa","attrs":{"2890601454aa":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Actual value of Testing","line":{"width":3},"inherit":true},"2890601454aa.1":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Predicted value of Testing","line":{"dash":"dot","width":4},"inherit":true},"2890601454aa.2":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Actual of Forecasting","line":{"width":3},"inherit":true},"2890601454aa.3":{"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"name":"Predicted of Forecasting","line":{"dash":"dot","width":4},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Evaluating the model's forecasting result","yaxis":{"domain":[0,1],"automargin":true,"title":"Order Demand"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Time"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"lines","x":["2014-06-16","2014-06-23","2014-06-30","2014-07-07","2014-07-14","2014-07-21","2014-07-28","2014-08-04","2014-08-18","2014-08-25","2014-09-01","2014-09-08","2014-09-15","2014-09-22","2014-09-29","2014-10-06","2014-10-13","2014-10-20","2014-10-27","2014-11-03","2014-11-10","2014-11-17","2014-11-24","2014-12-08","2014-12-15","2014-12-22","2015-01-12","2015-01-19","2015-01-26","2015-02-02","2015-02-09","2015-02-16","2015-02-23","2015-03-02","2015-03-09","2015-03-16","2015-03-23","2015-03-30","2015-04-06","2015-04-13","2015-04-20","2015-04-27","2015-05-04","2015-05-11","2015-05-18","2015-05-25"],"y":[22260761,20150947,21453596,19529205,22285248,19056985,21980971,18509972,17492016,18638536,21204456,21685416,21138374,17533878,22930540,18893883,17569466,21548747,23918379,22232836,21415405,21795208,22955051,22499920,22087088,15759501,22268989,24411223,24764659,25305676,22765509,21627443,19081624,21835896,24974150,20421281,27335025,26808417,19562645,19216657,22677443,18621449,15332432,19324004,22930695,19897789],"name":"Actual value of Testing","line":{"color":"rgba(31,119,180,1)","width":3},"type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2014-06-16","2014-06-23","2014-06-30","2014-07-07","2014-07-14","2014-07-21","2014-07-28","2014-08-04","2014-08-18","2014-08-25","2014-09-01","2014-09-08","2014-09-15","2014-09-22","2014-09-29","2014-10-06","2014-10-13","2014-10-20","2014-10-27","2014-11-03","2014-11-10","2014-11-17","2014-11-24","2014-12-08","2014-12-15","2014-12-22","2015-01-12","2015-01-19","2015-01-26","2015-02-02","2015-02-09","2015-02-16","2015-02-23","2015-03-02","2015-03-09","2015-03-16","2015-03-23","2015-03-30","2015-04-06","2015-04-13","2015-04-20","2015-04-27","2015-05-04","2015-05-11","2015-05-18","2015-05-25"],"y":[19659601.205361854,20930437.18412162,19735770.590127479,19792564.952432167,20780880.639932167,20265313.730248939,19885399.729272377,21036246.960244667,20330342.373803627,19794232.665566932,21285997.907754432,20912038.486611854,20712988.810830604,18768965.51224662,20634101.79740287,19769053.311303627,20663674.999307167,19507518.884316932,20448972.92240287,19709422.381387245,21051366.195596229,20097392.49662162,19873753.325723182,20018655.28177787,19708612.86771537,20799922.993920814,20720680.62943412,20576237.23099662,19427858.760049354,20218251.845254432,19969477.923608314,19991628.05912162,20217635.22709037,19891197.338418495,19701395.220483314,18411165.46146537,18375339.40677787,21339150.976846229,20626487.730248939,20324066.618691932,20709868.190713417,20365842.54740287,21118372.291299354,19295680.595483314,18902527.27787162,18346522.981973182],"name":"Predicted value of Testing","line":{"color":"rgba(255,127,14,1)","dash":"dot","width":4},"type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2015-06-01","2015-06-08","2015-06-15","2015-06-22","2015-07-06","2015-07-13","2015-07-20","2015-07-27","2015-08-03","2015-08-17","2015-08-24","2015-08-31","2015-09-07","2015-09-14","2015-09-21","2015-09-28","2015-10-05","2015-10-12","2015-10-19","2015-10-26","2015-11-02","2015-11-09","2015-11-16","2015-11-23","2015-11-30","2015-12-07","2015-12-14","2015-12-21","2016-01-04","2016-01-11","2016-01-18","2016-01-25","2016-02-01","2016-02-08","2016-02-15","2016-02-22","2016-02-29","2016-03-07","2016-03-14","2016-03-21","2016-03-28","2016-04-04","2016-04-11","2016-04-18","2016-04-25","2016-05-02","2016-05-09","2016-05-16","2016-05-23","2016-05-30","2016-06-06","2016-06-13","2016-06-20","2016-06-27","2016-07-04","2016-07-11","2016-07-18","2016-07-25","2016-08-01","2016-08-08","2016-08-15","2016-08-22","2016-08-29","2016-09-05","2016-09-12","2016-09-19","2016-09-26","2016-10-03","2016-10-10","2016-10-17","2016-10-24","2016-10-31","2016-11-07","2016-11-14","2016-11-21","2016-11-28","2016-12-05","2016-12-12","2016-12-19"],"y":[19127898,21233567,20589686,20836689,18461206,22368900,19530250,25074235,25023078,23359538,18513500,26044284,21301254,17467541,12049718,24044104,23481598,19573393,19149451,18440919,18920410,19712992,20172078,16418919,23614306,25133540,17604112,18633142,21257253,19743800,21399017,15994362,23282872,13853856,15239296,16225127,22228193,18952893,23782946,17878698,20076930,20449466,17734007,19401206,16490121,11904220,21767274,18697574,20149830,19595404,16780492,15077140,18561483,23017389,22377223,18459147,16766401,26459173,21513691,13889835,14654129,18203632,18796217,17923624,15357930,13954638,23371498,17472193,21039841,21118703,21008982,17816031,22004901,19989964,19363613,26390008,21295477,19918175,17474312],"name":"Actual of Forecasting","line":{"color":"rgba(44,160,44,1)","width":3},"type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"lines","x":["2015-06-01","2015-06-08","2015-06-15","2015-06-22","2015-07-06","2015-07-13","2015-07-20","2015-07-27","2015-08-03","2015-08-17","2015-08-24","2015-08-31","2015-09-07","2015-09-14","2015-09-21","2015-09-28","2015-10-05","2015-10-12","2015-10-19","2015-10-26","2015-11-02","2015-11-09","2015-11-16","2015-11-23","2015-11-30","2015-12-07","2015-12-14","2015-12-21","2016-01-04","2016-01-11","2016-01-18","2016-01-25","2016-02-01","2016-02-08","2016-02-15","2016-02-22","2016-02-29","2016-03-07","2016-03-14","2016-03-21","2016-03-28","2016-04-04","2016-04-11","2016-04-18","2016-04-25","2016-05-02","2016-05-09","2016-05-16","2016-05-23","2016-05-30","2016-06-06","2016-06-13","2016-06-20","2016-06-27","2016-07-04","2016-07-11","2016-07-18","2016-07-25","2016-08-01","2016-08-08","2016-08-15","2016-08-22","2016-08-29","2016-09-05","2016-09-12","2016-09-19","2016-09-26","2016-10-03","2016-10-10","2016-10-17","2016-10-24","2016-10-31","2016-11-07","2016-11-14","2016-11-21","2016-11-28","2016-12-05","2016-12-12","2016-12-19"],"y":[18887745.84818412,20048923.486108314,18590696.716348182,20918678.626733314,17990936.653848182,18264060.330834877,19230177.646264564,18490833.576699745,18048693.42240287,20115874.45365287,18145797.694116127,18430327.708535682,17866733.583764564,18220739.85599662,19370956.436074745,20870225.033730995,18061667.811303627,20517202.353066932,18645694.616967689,20150132.38334037,20867259.78177787,18439164.478295814,18222191.411660682,17771949.18412162,19471257.86380912,18536027.39115287,18818497.939004432,19005200.24662162,19004883.82084037,18645694.616967689,18110366.893334877,18318650.854272377,17573871.56693412,17573871.56693412,18645694.616967689,18490833.576699745,18222191.411660682,18636119.91068412,18296173.51224662,18746365.087670814,19471257.86380912,18695337.10599662,17771157.427285682,18778700.69584037,18585188.748803627,20066511.435098182,18620962.615991127,18284303.43802787,18086058.15287162,18063777.747598182,18490833.576699745,18626273.32865287,18331947.37943412,18968689.658959877,17477693.51615287,18657156.77787162,17771157.427285682,18133100.72709037,19471257.86380912,18775156.942910682,18467754.225366127,17926018.467553627,18110366.893334877,18277049.458535682,18157571.54349662,18632024.114785682,18772253.169473182,18601285.55521537,17771157.427285682,18645694.616967689,19201042.75834037,18893044.338647377,18726246.583535682,18274647.353295814,18881107.623803627,18477960.569116127,18380412.53959037,18881107.623803627,18620962.615991127],"name":"Predicted of Forecasting","line":{"color":"rgba(214,39,40,1)","dash":"dot","width":4},"type":"scatter","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="mô-hình-boosting" class="level4" data-number="2.3.4">
<h4 data-number="2.3.4" class="anchored" data-anchor-id="mô-hình-boosting"><span class="header-section-number">2.3.4</span> Mô hình Boosting:</h4>
<p>Tiếp đó, chúng ta sẽ thử với thuật toán boosting khá phổ biến là: <em>Stochastic Gradient Boosting</em>.</p>
<p>Stochastic Gradient Boosting: Là một biến thể của gradient boosting, kết hợp các yếu tố ngẫu nhiên trong quá trình huấn luyện để cải thiện tính chính xác và khả năng tổng quát của mô hình. Thay vì sử dụng toàn bộ dữ liệu huấn luyện để xây dựng mỗi mô hình trong chuỗi, Stochastic Gradient Boosting chỉ sử dụng một mẫu ngẫu nhiên (subsample) của dữ liệu. Mỗi mô hình mới được huấn luyện để sửa chữa các sai số của các mô hình trước đó.</p>
<p>Mục tiêu là giảm thiểu hàm mất mát (loss function) bằng cách sử dụng gradient descent.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Tạo một đối tượng control cho cross-validation</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>fitControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">"repeatedcv"</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">number=</span><span class="dv">10</span>, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">repeats=</span><span class="dv">10</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Trong đó</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># method = 'repeatedcv': sử dụng cross-validation với các tham số sau:</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># number = 10 có nhĩa là quá trình cross-validation cần chia dữ liệu gốc thành 10 phần bằng nhau</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># repeats = 10 có nghĩa là quá trình cross-validation cần lặp lại 10 lần</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Stochastic Gradient Boosting</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">825</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>gbmFit1 <span class="ot">&lt;-</span> <span class="fu">train</span>(Order_Demand<span class="sc">~</span>., </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> train_data <span class="sc">%&gt;%</span> </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(order_date,class)), </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"gbm"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> fitControl,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## This last option is actually one</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## for gbm() that passes through</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Sau khi đã training model, ta sẽ dùng mô hình đó để dự đoán và so sánh với giá trị thực tế ở testing data. Ta sẽ có kết quả như dưới đây:</p>
<p>Kết quả có vẻ ổn hơn Random Forest nhưng vẫn có 2 outliears vì độ chênh lệch lên đến 100-200%.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>predict<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> test_data<span class="sc">$</span>order_date,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> <span class="fu">predict</span>(gbmFit1, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newdata =</span> test_data <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(order_date,class))),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Observed =</span> test_data<span class="sc">$</span>Order_Demand) <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Diff =</span> <span class="fu">round</span>((Observed <span class="sc">-</span> Predicted)<span class="sc">/</span>Observed<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Check =</span> <span class="fu">ifelse</span>(Diff <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> Diff <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">5</span>, <span class="st">"Passed"</span>,<span class="st">"Failed"</span>))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtExtras)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(predict <span class="sc">%&gt;%</span> </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">count</span>(Check) <span class="sc">%&gt;%</span> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">Per =</span> <span class="fu">round</span>(n<span class="sc">/</span><span class="fu">nrow</span>(predict),<span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Check =</span> <span class="fu">md</span>(<span class="st">"**Status**"</span>),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">md</span>(<span class="st">"**Count**"</span>),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Per =</span> <span class="fu">md</span>(<span class="st">"**Percentage**"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Evaluating the model's accuracy**"</span>),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Forecasting from {min(test_data$order_date)} to {max(test_data$order_date)}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">tab_source_note</span>(</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">source_note =</span> <span class="fu">str_glue</span>(<span class="st">"Smaller 5% means passed"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_538</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Check"</span>),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">"factor"</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"blue"</span>))</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> predict,</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Period, </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Diff)) <span class="sc">+</span> </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">1</span>, </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype=</span><span class="st">"dashed"</span>, </span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Time'</span>) <span class="sc">+</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Difference (%)'</span>) <span class="sc">+</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evaluating model builded by GBM method"</span>,</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Observed vs Predicted value"</span>,</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"The red line is abline Y = 0 means accuracry prediction and the blue line is the linear lines between observed and predicted value."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 30.0%;justify-content: center;">

<div id="zwedhapdmi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Chivo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Cairo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#zwedhapdmi table {
  font-family: Cairo, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zwedhapdmi thead, #zwedhapdmi tbody, #zwedhapdmi tfoot, #zwedhapdmi tr, #zwedhapdmi td, #zwedhapdmi th {
  border-style: none;
}

#zwedhapdmi p {
  margin: 0;
  padding: 0;
}

#zwedhapdmi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: 400;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: none;
  border-top-width: 3px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zwedhapdmi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zwedhapdmi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zwedhapdmi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zwedhapdmi .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zwedhapdmi .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zwedhapdmi .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zwedhapdmi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zwedhapdmi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zwedhapdmi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zwedhapdmi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zwedhapdmi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zwedhapdmi .gt_spanner_row {
  border-bottom-style: hidden;
}

#zwedhapdmi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #000000;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zwedhapdmi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #000000;
  border-bottom-style: solid;
  border-bottom-width: 1px;
  border-bottom-color: #FFFFFF;
  vertical-align: middle;
}

#zwedhapdmi .gt_from_md > :first-child {
  margin-top: 0;
}

#zwedhapdmi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zwedhapdmi .gt_row {
  padding-top: 3px;
  padding-bottom: 3px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zwedhapdmi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 0px;
  border-right-color: #FFFFFF;
  padding-left: 5px;
  padding-right: 5px;
}

#zwedhapdmi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zwedhapdmi .gt_row_group_first td {
  border-top-width: 2px;
}

#zwedhapdmi .gt_row_group_first th {
  border-top-width: 2px;
}

#zwedhapdmi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zwedhapdmi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zwedhapdmi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zwedhapdmi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zwedhapdmi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zwedhapdmi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zwedhapdmi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zwedhapdmi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zwedhapdmi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zwedhapdmi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zwedhapdmi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zwedhapdmi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zwedhapdmi .gt_sourcenote {
  font-size: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zwedhapdmi .gt_left {
  text-align: left;
}

#zwedhapdmi .gt_center {
  text-align: center;
}

#zwedhapdmi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zwedhapdmi .gt_font_normal {
  font-weight: normal;
}

#zwedhapdmi .gt_font_bold {
  font-weight: bold;
}

#zwedhapdmi .gt_font_italic {
  font-style: italic;
}

#zwedhapdmi .gt_super {
  font-size: 65%;
}

#zwedhapdmi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zwedhapdmi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zwedhapdmi .gt_indent_1 {
  text-indent: 5px;
}

#zwedhapdmi .gt_indent_2 {
  text-indent: 10px;
}

#zwedhapdmi .gt_indent_3 {
  text-indent: 15px;
}

#zwedhapdmi .gt_indent_4 {
  text-indent: 20px;
}

#zwedhapdmi .gt_indent_5 {
  text-indent: 25px;
}

#zwedhapdmi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zwedhapdmi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}

tbody tr:last-child {
  border-bottom: 2px solid #ffffff00;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="3" class="gt_heading gt_title gt_font_normal" style="font-family: Chivo; font-weight: 700;"><div data-qmd-base64="KipFdmFsdWF0aW5nIHRoZSBtb2RlbCdzIGFjY3VyYWN5Kio="><div class="gt_from_md"><p><strong>Evaluating the model’s accuracy</strong></p>
</div></div></td>
    </tr>
    <tr class="gt_heading">
      <td colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style="font-family: Chivo; font-weight: 300;">Forecasting from 2014-06-16 to 2015-05-25</td>
    </tr>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;" scope="col" id="<div data-qmd-base64=&quot;KipTdGF0dXMqKg==&quot;><div class='gt_from_md'><p><strong>Status</strong></p>
</div></div>"><div data-qmd-base64="KipTdGF0dXMqKg=="><div class="gt_from_md"><p><strong>Status</strong></p>
</div></div></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;" scope="col" id="<div data-qmd-base64=&quot;KipDb3VudCoq&quot;><div class='gt_from_md'><p><strong>Count</strong></p>
</div></div>"><div data-qmd-base64="KipDb3VudCoq"><div class="gt_from_md"><p><strong>Count</strong></p>
</div></div></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="border-top-width: 0px; border-top-style: solid; border-top-color: black; font-family: Chivo; font-size: 14px; vertical-align: bottom; font-weight: 200; text-transform: uppercase;" scope="col" id="<div data-qmd-base64=&quot;KipQZXJjZW50YWdlKio=&quot;><div class='gt_from_md'><p><strong>Percentage</strong></p>
</div></div>"><div data-qmd-base64="KipQZXJjZW50YWdlKio="><div class="gt_from_md"><p><strong>Percentage</strong></p>
</div></div></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Check" class="gt_row gt_left" style="background-color: #FF0000; color: #FFFFFF;">Failed</td>
<td headers="n" class="gt_row gt_right">27</td>
<td headers="Per" class="gt_row gt_right">0.587</td></tr>
    <tr><td headers="Check" class="gt_row gt_left" style="background-color: #0000FF; color: #FFFFFF;">Passed</td>
<td headers="n" class="gt_row gt_right">19</td>
<td headers="Per" class="gt_row gt_right">0.413</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="3">Smaller 5% means passed</td>
    </tr>
  </tfoot>
  
</table>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 70.0%;justify-content: center;">
<p><img src="EnsembleML_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="tuning-parameters" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="tuning-parameters"><span class="header-section-number">3</span> Tuning parameters:</h2>
<p>Tiêu đề của mục này là keyword mà bạn cần nắm về Machine Learning. Theo nghiên cứu của <span class="citation" data-cites="dungnguyenchí">(<a href="#ref-dungnguyenchí" role="doc-biblioref">Dũng, Nguyễn Chí, n.d.</a>)</span>, các thuật toán ML có các tham số mà việc điều chỉnh tham số sẽ ảnh hưởng đến kết quả dự đoán. Vậy chuyên đề tìm ra tham số tối ưu nhất là mục quan trọng khi bạn sử dụng ML.</p>
<p>Về mặt lý thuyết, có nhiều cách để tìm ra, ở bài này mình sẽ sử dụng 3 cách là:</p>
<ul>
<li>Full Grid Search.</li>
<li>Random Search.</li>
<li>Default Search.</li>
</ul>
<p>Và hầu như không có cách nào tìm ra tham số tối ưu nhất bằng cách thực nghiệm trên một bộ dữ liệu thực tế. Do đó, ở bài này, chúng ta sẽ lược qua cả 3 cách đã nêu trên và so sánh chúng để chọn ra các tối ưu nhất.</p>
<p>Vậy có quá nhiều thuật toán ML vậy, làm sao ta biết được thuật toán nào cần chỉnh tham số nào? Trong R có hàm để chúng ta tự tìm hiểu, đó là <code>getModelInfo</code>. Dưới đây là 1 ví dụ về thuật toán mà ta đã dùng ở trên:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getModelInfo</span>(<span class="st">"gbm"</span>)<span class="sc">$</span>gbm<span class="sc">$</span>parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          parameter   class                   label
1           n.trees numeric   # Boosting Iterations
2 interaction.depth numeric          Max Tree Depth
3         shrinkage numeric               Shrinkage
4    n.minobsinnode numeric Min. Terminal Node Size</code></pre>
</div>
</div>
<p>Vậy tiếp theo chúng ta sẽ điều chỉnh tham số để tối ưu kết quả của mô hình. Chi tiết ở dưới phần code.</p>
<ul>
<li>number of iterations, i.e.&nbsp;trees, (called n.trees in the gbm function).</li>
<li>complexity of the tree, called interaction.depth learning rate: how quickly the algorithm adapts, called shrinkage.</li>
<li>the minimum number of training set samples in a node to commence splitting (n.minobsinnode)</li>
</ul>
<p>Dựa trên hướng dẫn của <span class="citation" data-cites="jasonbrownlee2020">(<a href="#ref-jasonbrownlee2020" role="doc-biblioref">Jason Brownlee 2020</a>)</span>, ta sẽ thực hành qua cả 3 phương pháp. Code chi tiết dưới đây.</p>
<section id="phương-pháp-random-search" class="level4" data-number="3.0.1">
<h4 data-number="3.0.1" class="anchored" data-anchor-id="phương-pháp-random-search"><span class="header-section-number">3.0.1</span> Phương pháp Random Search:</h4>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Random Search
</div>
</div>
<div class="callout-body-container callout-body">
<p>control &lt;- trainControl(method=“repeatedcv”, number=10, repeats=3, search=“random”)</p>
<p>mtry &lt;- sqrt(ncol(train_data))</p>
<p>gbm_random &lt;- train(Order_Demand~., data = train_data %&gt;% select(-c(order_date,class)), method=“gbm”, tuneLength = 5, trControl = control)</p>
<p>plot(gbm_random)</p>
</div>
</div>
</section>
<section id="phương-pháp-grid-search" class="level4" data-number="3.0.2">
<h4 data-number="3.0.2" class="anchored" data-anchor-id="phương-pháp-grid-search"><span class="header-section-number">3.0.2</span> Phương pháp Grid Search:</h4>
<p>Với phương pháp Grid Search, ta chỉ cần đổi đối số <code>search = "grid"</code> và thêm đối số <code>tuneGrid</code>.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Grid Search
</div>
</div>
<div class="callout-body-container callout-body">
<p>control &lt;- trainControl(method=“repeatedcv”, number=10, repeats=3, search=“grid”)</p>
<p>tunegrid &lt;- expand.grid(.mtry=c(1:5))</p>
<p>gbm_gridsearch&lt;-train(Order_Demand~., data = train_data %&gt;% select(-c(order_date,class)), method=“gbm”, tuneGrid=tunegrid, trControl = control)</p>
<p>plot(gbm_gridsearch)</p>
</div>
</div>
<p>Cảm ơn các bạn đã ghé thăm và đọc bài viết của mình!!!</p>


<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-cuongsai2020" class="csl-entry" role="listitem">
Cuong Sai. 2020. <span>“Phương Pháp Ensemble Learning Trong Machine Learning: Boosting, Bagging, Stacking (Sử Dụng r Code).”</span> <a href="https://svcuong.github.io/post/ensemble-learning/">https://svcuong.github.io/post/ensemble-learning/</a>.
</div>
<div id="ref-dungnguyenchí" class="csl-entry" role="listitem">
Dũng, Nguyễn Chí. n.d. <span>“Real-World Machine Learning: A Hands-on Approach Using r.”</span> <a href="https://rpubs.com/chidungkt/817679">https://rpubs.com/chidungkt/817679</a>.
</div>
<div id="ref-jasonbrownlee2020" class="csl-entry" role="listitem">
Jason Brownlee. 2020. <span>“Tune Machine Learning Algorithms in r (Random Forest Case Study).”</span> <a href="https://machinelearningmastery.com/tune-machine-learning-algorithms-in-r/">https://machinelearningmastery.com/tune-machine-learning-algorithms-in-r/</a>.
</div>
<div id="ref-sauravkaushik8kaushik2019" class="csl-entry" role="listitem">
Sauravkaushik8 Kaushik. 2019. <span>“How to Build Ensemble Models in Machine Learning? (With Code in r).”</span> <a href="https://www.analyticsvidhya.com/blog/2017/02/introduction-to-ensembling-along-with-implementation-in-r/">https://www.analyticsvidhya.com/blog/2017/02/introduction-to-ensembling-along-with-implementation-in-r/</a>.
</div>
<div id="ref-topdev" class="csl-entry" role="listitem">
Topdev. n.d. <span>“Machine Learning Là Gì?”</span> <a href="https://topdev.vn/blog/machine-learning-la-gi/">https://topdev.vn/blog/machine-learning-la-gi/</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb23" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Machine Learning"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Việt Nam, 2024"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> ["Machine Learning", "Forecasting"]</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dự đoán bằng Machine Learning:</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">### Định nghĩa về Machine Learning:</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>Theo <span class="co">[</span><span class="ot">@topdev</span><span class="co">]</span>, Machine learning (ML) hay máy học là "*một nhánh của trí tuệ nhân tạo (AI), nó là một lĩnh vực nghiên cứu cho phép máy tính có khả năng cải thiện chính bản thân chúng dựa trên dữ liệu mẫu (training data) hoặc dựa vào kinh nghiệm (những gì đã được học). Machine learning có thể tự dự đoán hoặc đưa ra quyết định mà không cần được lập trình cụ thể.*"</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>Phương pháp Machine Learning từng "gây bão" trong giới khoa học khi ra mắt vì khả năng xây dựng mô hình nhanh chóng và sự chuẩn xác của mô hình trong việc dự đoán và phân loại kết quả. Với sự phát triển của khoa học, lượng lớn dữ liệu được thu thập hay được gọi là Big Data đòi hỏi nhu cầu tính toán nhanh chóng và công cụ mạnh. Các phương pháp khoa học truyền thống lại không làm tốt việc này bằng Machine Learning.</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>Ngoài ra, khác với các mô hình truyền thống đòi hỏi nhiều về đáp ứng giả định và quy tắc rắc rối, Machine Learning giúp con người nhanh chóng đưa ra quyết định và có thể tự cải thiện performance của mình bằng học máy mà không cần người dùng phải tương tác nhiều.</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="fu">### Thuật toán Ensemble Machine Learning:</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>Trong machine learning tồn tại định lý “*không có bữa trưa miễn phí”* (No free lunch theorem), tức là không tồn tại một thuật toán mà tốt cho mọi ứng dụng và mọi tập dữ liệu. Vì ML có nhiều thuật toán khác nhau và tùy vào đặc tính của bộ dữ liệu mà thuật toán ML sẽ tính ra kết quả khác nhau. Muốn tìm ra thuật toán phù hợp, người sử dụng phải cần nhiều thời gian để test và điều chỉnh hệ số (tuning hyperparameters) để đạt độ chính xác cao.</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>Và thuật toán Ensemble ML có thể giúp người dùng giảm thời gian trong việc testing bằng cách kết hợp các mô hình này với nhau. Theo <span class="co">[</span><span class="ot">@cuongsai2020</span><span class="co">]</span>,"Ý tưởng của việc combine các mô hình khác nhau xuất phát từ một suy nghĩ hợp lý là: các mô hình khác nhau có khả năng khác nhau, có thể thực hiện tốt nhất các loại công việc khác nhau (subtasks), khi kết hợp các mô hình này với nhau một cách hợp lý thì sẽ tạo thành một mô hình kết hợp (combined model) mạnh có khả năng cải thiện hiệu suât tổng thể (overall performance) so với việc chỉ dùng các mô hình một cách đơn lẻ."</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>Thuật toán Ensemble ML chia thành 3 loại:</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Bagging: chia bộ dữ liệu thành subsamples và xây dựng thành model cùng kiểu với nhau để đưa ra dự đoán.</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Boosting: cũng chia dữ liệu thành subsamples nhưng việc xây dựng mô hình không diễn ra cùng lúc như bagging mà là theo chuỗi nối tiếp nhau.</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>Bạn có thể tưởng tượng như hình dưới đây:</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="al">![Hình 6: Bagging vs Boosting method.](img/Bagging_Boosting.png)</span>{fig-align="center"}</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stacking xây dựng các mô hình khác loại từ training data và một mô hình supervisor model. Sau đó, mô hình này sẽ kết hợp các kết quả dự báo để tìm ra mô hình tốt nhất.</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="al">![Hình 7: Staking method.](img/Staking.png)</span>{fig-align="center"}</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>Vậy tiếp theo, chúng ta sẽ thử dùng Ensemble ML trong R để dự đoán.</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### So sánh với mô hình ARIMA:</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>Machine Learning làm tốt về mặt performance ở các vấn đề như: phân loại nhãn (Classification), tự học và bổ sung (AI), phân tích lớp ảnh (Neural network),... nhưng ở lĩnh vực dự đoán chuỗi thời gian (Time series forecast), ML lại không tốt bằng các phương pháp thống kê truyền thống.</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## Thực hành trong R:</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chuẩn bị dữ liệu:</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>Bạn có thể quay lại trang đầu tiên để lấy dữ liệu gốc và các bước để chỉnh sửa dữ liệu ở <span class="co">[</span><span class="ot">Giới thiệu</span><span class="co">](index.qmd)</span>.</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a><span class="co">#Call packages:</span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rio,</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>               here,</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>               janitor,</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>               tidyverse,</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>               dplyr,</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>               magrittr,</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>               lubridate,</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>               stringr</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a><span class="co">#Import file:</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>product_demand<span class="ot">&lt;-</span><span class="fu">import</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">locca</span><span class="sc">\\</span><span class="st">Downloads</span><span class="sc">\\</span><span class="st">Historical Product Demand.csv"</span>)</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="co">#Change to suitable class (I change the name dataset to product_demand to shortly write)</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>product_demand <span class="ot">&lt;-</span>product_demand <span class="sc">%&gt;%</span> </span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date,<span class="at">format =</span> <span class="st">"%Y/%m/%d"</span>),</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>           <span class="at">Product_Category =</span> <span class="fu">as.factor</span>(Product_Category))</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>product_demand<span class="sc">$</span>Order_Demand <span class="ot">&lt;-</span> </span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">"[(]"</span>, <span class="st">"-"</span>, product_demand<span class="sc">$</span>Order_Demand)</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>product_demand<span class="sc">$</span>Order_Demand <span class="ot">&lt;-</span> </span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">"[)]"</span>, <span class="st">""</span>, product_demand<span class="sc">$</span>Order_Demand)</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>product_demand<span class="sc">$</span>Order_Demand <span class="ot">&lt;-</span> </span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(product_demand<span class="sc">$</span>Order_Demand)</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a><span class="co">#Then I will create a lot of cols contain year, month, week data and just select from 2012 to 2016:</span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>product_demand <span class="ot">&lt;-</span>product_demand <span class="sc">%&gt;%</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">month</span>(Date),</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(Date),</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>         <span class="at">Week_day =</span> <span class="fu">wday</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2016</span><span class="sc">:</span><span class="dv">2012</span>))</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>Trong phần này, đối với Machine Learning, ta nên chia bộ dữ liệu thành 3 bộ: training, testing và forecasting dataset. Ngoài ra, ML cần dữ liệu lớn nên ta sẽ tính theo tuần chứ không theo tháng như các phần trước.</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a><span class="co">#Sum by daily and remove negative value:</span></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>weekly_df<span class="ot">&lt;-</span>product_demand <span class="sc">%&gt;%</span> </span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Warehouse,</span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>           Date,</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>           Order_Demand)) <span class="sc">%&gt;%</span></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">order_date =</span> <span class="fu">floor_date</span>(Date, </span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">unit =</span> <span class="st">'week'</span>, </span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># setting up week commencing Monday</span></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>                     <span class="at">week_start =</span> <span class="fu">getOption</span>(<span class="st">"lubridate.week.start"</span>, </span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>                                            <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(order_date) <span class="sc">%&gt;%</span></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Order_Demand =</span> <span class="fu">sum</span>(Order_Demand)) <span class="sc">%&gt;%</span></span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a><span class="do">## Dividing the period of date:</span></span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="fu">quantile</span>(product_demand<span class="sc">$</span>Date, </span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a>            <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.99</span>), </span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="dv">1</span>)</span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span>weekly_df <span class="sc">%&gt;%</span> </span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(order_date <span class="sc">&lt;=</span> n[[<span class="dv">2</span>]])</span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">&lt;-</span>weekly_df <span class="sc">%&gt;%</span> </span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(order_date <span class="sc">&lt;=</span> n[[<span class="dv">3</span>]]<span class="sc">&amp;</span>order_date <span class="sc">&gt;</span> n[[<span class="dv">2</span>]])</span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">&lt;-</span>weekly_df <span class="sc">%&gt;%</span> </span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(order_date <span class="sc">&lt;=</span> n[[<span class="dv">4</span>]]<span class="sc">&amp;</span>order_date <span class="sc">&gt;</span> n[[<span class="dv">3</span>]])</span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a><span class="do">## Transfering to xts class:</span></span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a>demand_training<span class="ot">&lt;-</span><span class="fu">xts</span>(<span class="at">x=</span>m1<span class="sc">$</span>Order_Demand,</span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a>                     <span class="at">order.by=</span>m1<span class="sc">$</span>order_date)</span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a>demand_testing<span class="ot">&lt;-</span><span class="fu">xts</span>(<span class="at">x=</span>m2<span class="sc">$</span>Order_Demand,</span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a>                     <span class="at">order.by=</span>m2<span class="sc">$</span>order_date)</span>
<span id="cb23-139"><a href="#cb23-139" aria-hidden="true" tabindex="-1"></a>demand_forecasting<span class="ot">&lt;-</span><span class="fu">xts</span>(<span class="at">x=</span>m3<span class="sc">$</span>Order_Demand,</span>
<span id="cb23-140"><a href="#cb23-140" aria-hidden="true" tabindex="-1"></a>                     <span class="at">order.by=</span>m3<span class="sc">$</span>order_date)</span>
<span id="cb23-141"><a href="#cb23-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-142"><a href="#cb23-142" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the result:</span></span>
<span id="cb23-143"><a href="#cb23-143" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dygraphs)</span>
<span id="cb23-144"><a href="#cb23-144" aria-hidden="true" tabindex="-1"></a>lines<span class="ot">&lt;-</span><span class="fu">cbind</span>(demand_training,</span>
<span id="cb23-145"><a href="#cb23-145" aria-hidden="true" tabindex="-1"></a>             demand_testing,</span>
<span id="cb23-146"><a href="#cb23-146" aria-hidden="true" tabindex="-1"></a>             demand_forecasting)</span>
<span id="cb23-147"><a href="#cb23-147" aria-hidden="true" tabindex="-1"></a><span class="fu">dygraph</span>(lines,</span>
<span id="cb23-148"><a href="#cb23-148" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Training and testing data"</span>, </span>
<span id="cb23-149"><a href="#cb23-149" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Quantity order (Unit: Millions)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-150"><a href="#cb23-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dySeries</span>(<span class="st">"demand_training"</span>, <span class="at">label =</span> <span class="st">"Training data"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-151"><a href="#cb23-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dySeries</span>(<span class="st">"demand_testing"</span>, <span class="at">label =</span> <span class="st">"Testing data"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-152"><a href="#cb23-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dySeries</span>(<span class="st">"demand_forecasting"</span>, <span class="at">label =</span> <span class="st">"Forecasting data"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-153"><a href="#cb23-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyOptions</span>(<span class="at">fillGraph =</span> <span class="cn">TRUE</span>, <span class="at">fillAlpha =</span> <span class="fl">0.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-154"><a href="#cb23-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyRangeSelector</span>(<span class="at">height =</span> <span class="dv">20</span>)</span>
<span id="cb23-155"><a href="#cb23-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-156"><a href="#cb23-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-157"><a href="#cb23-157" aria-hidden="true" tabindex="-1"></a>Giống ý tưởng của ARIMA, Ensemble ML cũng phân tích mối tương quan giữa giá trị tại thời điểm t với thời điểm t-1, t-2,... Và vì ta đã có dữ liệu tại thời điểm t nên ta cần tính giá trị tại các thời điểm t-1, t-2 bằng hàm <span class="in">`lag`</span>.</span>
<span id="cb23-158"><a href="#cb23-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-159"><a href="#cb23-159" aria-hidden="true" tabindex="-1"></a>Trong R, có hàm <span class="in">`ts_lags`</span> để kiếm tra mức độ tương quan giữa biến hiện tại và các biến trong quá khứ. Mặc định, hàm sẽ tính cho ta trong 12 lags nhưng ta có thể chỉ định bằng đối số: <span class="in">`lags = c()`</span></span>
<span id="cb23-160"><a href="#cb23-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-163"><a href="#cb23-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-164"><a href="#cb23-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-165"><a href="#cb23-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-166"><a href="#cb23-166" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSstudio)</span>
<span id="cb23-167"><a href="#cb23-167" aria-hidden="true" tabindex="-1"></a><span class="fu">ts_lags</span>(demand_training, <span class="at">lags =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">26</span>, <span class="dv">39</span>, <span class="dv">52</span>))</span>
<span id="cb23-168"><a href="#cb23-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-169"><a href="#cb23-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-170"><a href="#cb23-170" aria-hidden="true" tabindex="-1"></a>Dựa vào biểu đồ trên này, ta thấy được mối quan hệ tuyến tính theo hướng tích cực giữa dữ liệu chuỗi và giá trị của nó ở lag 52 (nghĩa là 1 năm sau) và hướng tiêu cực với giá trị của nó ở lag 13.</span>
<span id="cb23-171"><a href="#cb23-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-172"><a href="#cb23-172" aria-hidden="true" tabindex="-1"></a>Do đó, chúng ta sẽ tạo lại bộ dữ liệu có các biến mới.</span>
<span id="cb23-173"><a href="#cb23-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-176"><a href="#cb23-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-177"><a href="#cb23-177" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-178"><a href="#cb23-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-179"><a href="#cb23-179" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> </span>
<span id="cb23-180"><a href="#cb23-180" aria-hidden="true" tabindex="-1"></a>  weekly_df <span class="sc">%&gt;%</span> </span>
<span id="cb23-181"><a href="#cb23-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trend       =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(weekly_df),</span>
<span id="cb23-182"><a href="#cb23-182" aria-hidden="true" tabindex="-1"></a>         <span class="at">trend_sqr   =</span> trend<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb23-183"><a href="#cb23-183" aria-hidden="true" tabindex="-1"></a>         <span class="at">rev_lag_13  =</span> <span class="fu">lag</span>(Order_Demand, <span class="at">n =</span> <span class="dv">13</span>),</span>
<span id="cb23-184"><a href="#cb23-184" aria-hidden="true" tabindex="-1"></a>         <span class="at">rev_lag_52  =</span> <span class="fu">lag</span>(Order_Demand, <span class="at">n =</span> <span class="dv">52</span>),</span>
<span id="cb23-185"><a href="#cb23-185" aria-hidden="true" tabindex="-1"></a>         <span class="at">season      =</span> <span class="fu">case_when</span>(Order_Demand <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-186"><a href="#cb23-186" aria-hidden="true" tabindex="-1"></a>                                 <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb23-187"><a href="#cb23-187" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb23-188"><a href="#cb23-188" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rev_lag_52)<span class="sc">&amp;!</span><span class="fu">is.na</span>(rev_lag_13)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-189"><a href="#cb23-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">ifelse</span>(order_date <span class="sc">&lt;=</span> n[[<span class="dv">2</span>]],</span>
<span id="cb23-190"><a href="#cb23-190" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"train"</span>,</span>
<span id="cb23-191"><a href="#cb23-191" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ifelse</span>(order_date <span class="sc">&gt;</span> n[[<span class="dv">2</span>]]<span class="sc">&amp;</span> order_date <span class="sc">&lt;=</span> n[[<span class="dv">3</span>]],</span>
<span id="cb23-192"><a href="#cb23-192" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"test"</span>,<span class="st">"forecast"</span>)))</span>
<span id="cb23-193"><a href="#cb23-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-194"><a href="#cb23-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-195"><a href="#cb23-195" aria-hidden="true" tabindex="-1"></a><span class="fu">### Xử lí missing value và outliers:</span></span>
<span id="cb23-196"><a href="#cb23-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-197"><a href="#cb23-197" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Missing value:</span></span>
<span id="cb23-198"><a href="#cb23-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-199"><a href="#cb23-199" aria-hidden="true" tabindex="-1"></a>Gía trị NA xuất hiện là do ta đang lấy dữ liệu từ quá khứ thời điểm cách 1 tháng, 2 tháng và 3 tháng. Vì Machine Learning bắt buộc phải có đầy đủ giá trị nên ta có thể sử dụng cách khác để tạo ra giá trị thay thế cho NA. Mình kham khảo được cách này từ <span class="co">[</span><span class="ot">@sauravkaushik8kaushik2019</span><span class="co">]</span>.</span>
<span id="cb23-200"><a href="#cb23-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-201"><a href="#cb23-201" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Outliers:</span></span>
<span id="cb23-202"><a href="#cb23-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-203"><a href="#cb23-203" aria-hidden="true" tabindex="-1"></a>Ngoài ra, vấn đề về *outliers* cũng cần được quan tâm. *Outlier* là các giá trị có vẻ "lệch" hoặc không bình thường so với toàn bộ dữ liệu. Nguyên nhân xuất hiện outlier có thể do các biến cố không lường trước hoặc đơn giản là sai sót trong việc đo lường, tính toán của người thu thập dữ liệu.</span>
<span id="cb23-204"><a href="#cb23-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-205"><a href="#cb23-205" aria-hidden="true" tabindex="-1"></a>Vì mục đích của chúng ta là xây dựng mô hình nên các outliers không giúp ích nhiều. Do đó chúng ta cần loại bỏ nó trước khi mô hình hóa.</span>
<span id="cb23-206"><a href="#cb23-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-209"><a href="#cb23-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-210"><a href="#cb23-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-211"><a href="#cb23-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-212"><a href="#cb23-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Biểu đồ phân bố của 3 bộ dữ liệu"</span></span>
<span id="cb23-213"><a href="#cb23-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: "Các điểm đen lạc lỏng ở ngoài vùng boxplot chính là outliers"</span></span>
<span id="cb23-214"><a href="#cb23-214" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb23-215"><a href="#cb23-215" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(model_data,</span>
<span id="cb23-216"><a href="#cb23-216" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Order_Demand,</span>
<span id="cb23-217"><a href="#cb23-217" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="fu">as.factor</span>(class),</span>
<span id="cb23-218"><a href="#cb23-218" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">as.factor</span>(class))) <span class="sc">+</span></span>
<span id="cb23-219"><a href="#cb23-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb23-220"><a href="#cb23-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb23-221"><a href="#cb23-221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color=</span><span class="st">"black"</span>, </span>
<span id="cb23-222"><a href="#cb23-222" aria-hidden="true" tabindex="-1"></a>                <span class="at">size=</span><span class="fl">0.4</span>, </span>
<span id="cb23-223"><a href="#cb23-223" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb23-224"><a href="#cb23-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-225"><a href="#cb23-225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb23-226"><a href="#cb23-226" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position=</span><span class="st">"none"</span>,</span>
<span id="cb23-227"><a href="#cb23-227" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>,</span>
<span id="cb23-228"><a href="#cb23-228" aria-hidden="true" tabindex="-1"></a>                                <span class="at">hjust=</span><span class="dv">1</span>, </span>
<span id="cb23-229"><a href="#cb23-229" aria-hidden="true" tabindex="-1"></a>                                <span class="at">vjust=</span><span class="fl">0.5</span>, </span>
<span id="cb23-230"><a href="#cb23-230" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face=</span><span class="st">'bold'</span>)</span>
<span id="cb23-231"><a href="#cb23-231" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb23-232"><a href="#cb23-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"A boxplot with jitter"</span>) <span class="sc">+</span></span>
<span id="cb23-233"><a href="#cb23-233" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb23-234"><a href="#cb23-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Dataset"</span>)</span>
<span id="cb23-235"><a href="#cb23-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-236"><a href="#cb23-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-237"><a href="#cb23-237" aria-hidden="true" tabindex="-1"></a>Cách xử lí outliers khá đơn giản. Ở đây mình sử dụng phương pháp IQR hay còn gọi là tứ phân vị. Sau khi xử lí, bạn có thể chạy lại code trên để kiểm tra xem outliers đã được loại bỏ hay chưa.</span>
<span id="cb23-238"><a href="#cb23-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-239"><a href="#cb23-239" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![Hình 8: IQR method.](img/IQR.png)</span><span class="ot">{fig-align="center"}</span><span class="co">](https://svcuong.github.io/post/remove-outliers/)</span></span>
<span id="cb23-240"><a href="#cb23-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-243"><a href="#cb23-243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-244"><a href="#cb23-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Tính IQR</span></span>
<span id="cb23-245"><a href="#cb23-245" aria-hidden="true" tabindex="-1"></a>q25 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(model_data<span class="sc">$</span>Order_Demand, <span class="fl">0.25</span>)</span>
<span id="cb23-246"><a href="#cb23-246" aria-hidden="true" tabindex="-1"></a>q75 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(model_data<span class="sc">$</span>Order_Demand, <span class="fl">0.75</span>)</span>
<span id="cb23-247"><a href="#cb23-247" aria-hidden="true" tabindex="-1"></a>iqr <span class="ot">&lt;-</span> q75 <span class="sc">-</span> q25</span>
<span id="cb23-248"><a href="#cb23-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-249"><a href="#cb23-249" aria-hidden="true" tabindex="-1"></a><span class="co"># thiết lập giới hạn để xác định outliers</span></span>
<span id="cb23-250"><a href="#cb23-250" aria-hidden="true" tabindex="-1"></a>limit_iqr <span class="ot">=</span> <span class="fl">1.5</span><span class="sc">*</span>iqr</span>
<span id="cb23-251"><a href="#cb23-251" aria-hidden="true" tabindex="-1"></a>lower_iqr <span class="ot">=</span> q25 <span class="sc">-</span> limit_iqr</span>
<span id="cb23-252"><a href="#cb23-252" aria-hidden="true" tabindex="-1"></a>upper_iqr <span class="ot">=</span> q75 <span class="sc">+</span> limit_iqr</span>
<span id="cb23-253"><a href="#cb23-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-254"><a href="#cb23-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Loại bỏ các outliers</span></span>
<span id="cb23-255"><a href="#cb23-255" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> model_data[<span class="sc">-</span><span class="fu">which</span>(model_data<span class="sc">$</span>Order_Demand <span class="sc">&gt;</span> upper_iqr <span class="sc">|</span> model_data<span class="sc">$</span>Order_Demand <span class="sc">&lt;</span> lower_iqr),]</span>
<span id="cb23-256"><a href="#cb23-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-257"><a href="#cb23-257" aria-hidden="true" tabindex="-1"></a><span class="do">## Tạo các bộ dữ liệu training,testing và forecasting:</span></span>
<span id="cb23-258"><a href="#cb23-258" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> </span>
<span id="cb23-259"><a href="#cb23-259" aria-hidden="true" tabindex="-1"></a>  model_data <span class="sc">%&gt;%</span> </span>
<span id="cb23-260"><a href="#cb23-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">==</span> <span class="st">"train"</span>)</span>
<span id="cb23-261"><a href="#cb23-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-262"><a href="#cb23-262" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> </span>
<span id="cb23-263"><a href="#cb23-263" aria-hidden="true" tabindex="-1"></a>  model_data <span class="sc">%&gt;%</span> </span>
<span id="cb23-264"><a href="#cb23-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">==</span> <span class="st">"test"</span>)</span>
<span id="cb23-265"><a href="#cb23-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-266"><a href="#cb23-266" aria-hidden="true" tabindex="-1"></a>forecast_data <span class="ot">&lt;-</span> </span>
<span id="cb23-267"><a href="#cb23-267" aria-hidden="true" tabindex="-1"></a>  model_data <span class="sc">%&gt;%</span> </span>
<span id="cb23-268"><a href="#cb23-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">==</span> <span class="st">"forecast"</span>)</span>
<span id="cb23-269"><a href="#cb23-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-270"><a href="#cb23-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-271"><a href="#cb23-271" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dự đoán:</span></span>
<span id="cb23-272"><a href="#cb23-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-273"><a href="#cb23-273" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mô hình Random Forest:</span></span>
<span id="cb23-274"><a href="#cb23-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-275"><a href="#cb23-275" aria-hidden="true" tabindex="-1"></a>Đầu tiên chúng ta sẽ làm việc với thuật toán boosting khá phổ biến là: *Random Forest*.</span>
<span id="cb23-276"><a href="#cb23-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-277"><a href="#cb23-277" aria-hidden="true" tabindex="-1"></a>Random Forest là một phương pháp học máy thuộc loại ensemble learning, được sử dụng chủ yếu cho các bài toán phân loại và hồi quy. Đây là một kỹ thuật mạnh mẽ và phổ biến, được phát triển bởi Leo Breiman vào năm 2001.</span>
<span id="cb23-278"><a href="#cb23-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-279"><a href="#cb23-279" aria-hidden="true" tabindex="-1"></a>Về ưu Điểm:</span>
<span id="cb23-280"><a href="#cb23-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-281"><a href="#cb23-281" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Khả Năng Tổng Quát Cao: Random Forest thường có khả năng tổng quát tốt hơn so với các mô hình cây quyết định đơn lẻ, do giảm thiểu overfitting (quá khớp) nhờ vào sự kết hợp của nhiều cây.</span>
<span id="cb23-282"><a href="#cb23-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-283"><a href="#cb23-283" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Khả Năng Xử Lý Dữ Liệu Lớn và Nhiều Đặc Trưng: Random Forest có thể xử lý hiệu quả dữ liệu với số lượng lớn các đặc trưng và quan sát.</span>
<span id="cb23-284"><a href="#cb23-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-285"><a href="#cb23-285" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Khả Năng Đánh Giá Tầm Quan Trọng Của Các Đặc Trưng: Random Forest cung cấp thông tin về tầm quan trọng của từng đặc trưng trong việc đưa ra dự đoán, giúp ích trong việc chọn lọc và phân tích đặc trưng.</span>
<span id="cb23-286"><a href="#cb23-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-287"><a href="#cb23-287" aria-hidden="true" tabindex="-1"></a>Về nhược Điểm:</span>
<span id="cb23-288"><a href="#cb23-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-289"><a href="#cb23-289" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Khó Giải Thích: Mặc dù Random Forest có hiệu suất tốt, nhưng các mô hình cây quyết định kết hợp lại có thể khó giải thích và không trực quan bằng các mô hình đơn giản hơn.</span>
<span id="cb23-290"><a href="#cb23-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-291"><a href="#cb23-291" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Tốn Tài Nguyên Tính Toán: Đặc biệt khi số lượng cây lớn, Random Forest có thể yêu cầu nhiều tài nguyên tính toán và bộ nhớ.</span>
<span id="cb23-292"><a href="#cb23-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-295"><a href="#cb23-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-296"><a href="#cb23-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-297"><a href="#cb23-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-298"><a href="#cb23-298" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb23-299"><a href="#cb23-299" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(h2o)</span>
<span id="cb23-300"><a href="#cb23-300" aria-hidden="true" tabindex="-1"></a><span class="do">## specify the size of the memory allocation pool cluster. </span></span>
<span id="cb23-301"><a href="#cb23-301" aria-hidden="true" tabindex="-1"></a><span class="fu">h2o.init</span>(<span class="at">max_mem_size =</span> <span class="st">"8G"</span>)</span>
<span id="cb23-302"><a href="#cb23-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-303"><a href="#cb23-303" aria-hidden="true" tabindex="-1"></a><span class="do">## Set dependent and independent variabls:</span></span>
<span id="cb23-304"><a href="#cb23-304" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="st">"Order_Demand"</span></span>
<span id="cb23-305"><a href="#cb23-305" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(train_data) <span class="sc">%&gt;%</span> <span class="fu">as.h2o</span>(), </span>
<span id="cb23-306"><a href="#cb23-306" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(y, <span class="st">"order_date"</span>,<span class="st">"class"</span>))</span>
<span id="cb23-307"><a href="#cb23-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-308"><a href="#cb23-308" aria-hidden="true" tabindex="-1"></a><span class="do">## Build model:</span></span>
<span id="cb23-309"><a href="#cb23-309" aria-hidden="true" tabindex="-1"></a>rft_model <span class="ot">&lt;-</span> </span>
<span id="cb23-310"><a href="#cb23-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h2o.randomForest</span>(</span>
<span id="cb23-311"><a href="#cb23-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x, </span>
<span id="cb23-312"><a href="#cb23-312" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y, </span>
<span id="cb23-313"><a href="#cb23-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">training_frame =</span> train_data <span class="sc">%&gt;%</span> <span class="fu">as.h2o</span>(),</span>
<span id="cb23-314"><a href="#cb23-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">nfolds =</span> <span class="dv">10</span>,</span>
<span id="cb23-315"><a href="#cb23-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">ntrees =</span> <span class="dv">500</span>,</span>
<span id="cb23-316"><a href="#cb23-316" aria-hidden="true" tabindex="-1"></a>    <span class="at">stopping_metric =</span> <span class="st">"RMSE"</span>,</span>
<span id="cb23-317"><a href="#cb23-317" aria-hidden="true" tabindex="-1"></a>    <span class="at">stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb23-318"><a href="#cb23-318" aria-hidden="true" tabindex="-1"></a>    <span class="at">stopping_tolerance =</span> <span class="fl">0.005</span>,</span>
<span id="cb23-319"><a href="#cb23-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1975</span></span>
<span id="cb23-320"><a href="#cb23-320" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-321"><a href="#cb23-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-322"><a href="#cb23-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-323"><a href="#cb23-323" aria-hidden="true" tabindex="-1"></a>Phân tích thêm về mức độ quan trọng của các biến trong mô hình. Ta thấy biến <span class="in">`lag_50`</span> đóng vai trò quan trọng nhất, đúng như dự đoán của ta khi phân tích ở trên về mối tương quan.</span>
<span id="cb23-324"><a href="#cb23-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-327"><a href="#cb23-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-328"><a href="#cb23-328" aria-hidden="true" tabindex="-1"></a><span class="do">## visualise the variable importance </span></span>
<span id="cb23-329"><a href="#cb23-329" aria-hidden="true" tabindex="-1"></a>rft_model <span class="sc">%&gt;%</span> </span>
<span id="cb23-330"><a href="#cb23-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h2o.varimp_plot</span>()</span>
<span id="cb23-331"><a href="#cb23-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-332"><a href="#cb23-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-335"><a href="#cb23-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-336"><a href="#cb23-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-337"><a href="#cb23-337" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-338"><a href="#cb23-338" aria-hidden="true" tabindex="-1"></a>pred<span class="ot">&lt;-</span> <span class="fu">h2o.predict</span>(rft_model, </span>
<span id="cb23-339"><a href="#cb23-339" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> <span class="fu">as.h2o</span>(train_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-340"><a href="#cb23-340" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-341"><a href="#cb23-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actual =</span> train_data<span class="sc">$</span>Order_Demand,</span>
<span id="cb23-342"><a href="#cb23-342" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> train_data<span class="sc">$</span>order_date)</span>
<span id="cb23-343"><a href="#cb23-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-344"><a href="#cb23-344" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb23-345"><a href="#cb23-345" aria-hidden="true" tabindex="-1"></a>pred <span class="sc">%&gt;%</span> </span>
<span id="cb23-346"><a href="#cb23-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-347"><a href="#cb23-347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> date, <span class="at">y =</span> <span class="sc">~</span> actual, <span class="at">name =</span> <span class="st">'Actual'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-348"><a href="#cb23-348" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> date, <span class="at">y =</span> <span class="sc">~</span> predict, <span class="at">name =</span> <span class="st">'Random Forest'</span>, </span>
<span id="cb23-349"><a href="#cb23-349" aria-hidden="true" tabindex="-1"></a>              <span class="at">line =</span> <span class="fu">list</span>(<span class="at">dash =</span> <span class="st">'dot'</span>))</span>
<span id="cb23-350"><a href="#cb23-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-351"><a href="#cb23-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-352"><a href="#cb23-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-353"><a href="#cb23-353" aria-hidden="true" tabindex="-1"></a>Khi dùng dữ liệu của bộ Training data, ML dự đoán lại gần như sát với dữ liệu thực tế. Nhưng khi có dữ liệu mới vào Machine Learning không dự đoán tốt được. Ví dụ như dưới đây.</span>
<span id="cb23-354"><a href="#cb23-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-357"><a href="#cb23-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-358"><a href="#cb23-358" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-359"><a href="#cb23-359" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-360"><a href="#cb23-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb23-361"><a href="#cb23-361" aria-hidden="true" tabindex="-1"></a><span class="do">## Create table:</span></span>
<span id="cb23-362"><a href="#cb23-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-363"><a href="#cb23-363" aria-hidden="true" tabindex="-1"></a>plot_f<span class="ot">&lt;-</span><span class="cf">function</span>(model){</span>
<span id="cb23-364"><a href="#cb23-364" aria-hidden="true" tabindex="-1"></a>pred<span class="ot">&lt;-</span><span class="fu">rbind</span>(<span class="fu">h2o.predict</span>(model, </span>
<span id="cb23-365"><a href="#cb23-365" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> <span class="fu">as.h2o</span>(test_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-366"><a href="#cb23-366" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>(),</span>
<span id="cb23-367"><a href="#cb23-367" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h2o.predict</span>(model, </span>
<span id="cb23-368"><a href="#cb23-368" aria-hidden="true" tabindex="-1"></a>                   <span class="at">newdata =</span> <span class="fu">as.h2o</span>(forecast_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-369"><a href="#cb23-369" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb23-370"><a href="#cb23-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actual =</span> <span class="fu">c</span>(test_data<span class="sc">$</span>Order_Demand,</span>
<span id="cb23-371"><a href="#cb23-371" aria-hidden="true" tabindex="-1"></a>                    forecast_data<span class="sc">$</span>Order_Demand),</span>
<span id="cb23-372"><a href="#cb23-372" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="fu">c</span>(test_data<span class="sc">$</span>order_date,</span>
<span id="cb23-373"><a href="#cb23-373" aria-hidden="true" tabindex="-1"></a>                  forecast_data<span class="sc">$</span>order_date),</span>
<span id="cb23-374"><a href="#cb23-374" aria-hidden="true" tabindex="-1"></a>         <span class="at">class =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Testing"</span>,<span class="fu">nrow</span>(test_data)),</span>
<span id="cb23-375"><a href="#cb23-375" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rep</span>(<span class="st">"Forecasting"</span>,<span class="fu">nrow</span>(forecast_data))))</span>
<span id="cb23-376"><a href="#cb23-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-377"><a href="#cb23-377" aria-hidden="true" tabindex="-1"></a><span class="do">## Dividing the data for plotting purpose:</span></span>
<span id="cb23-378"><a href="#cb23-378" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> pred[<span class="fu">which</span>(pred<span class="sc">$</span>class <span class="sc">==</span> <span class="st">"Testing"</span>),]</span>
<span id="cb23-379"><a href="#cb23-379" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> pred[<span class="fu">which</span>(pred<span class="sc">$</span>class <span class="sc">==</span> <span class="st">"Forecasting"</span>),]</span>
<span id="cb23-380"><a href="#cb23-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-381"><a href="#cb23-381" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-382"><a href="#cb23-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span> pred1<span class="sc">$</span>date, </span>
<span id="cb23-383"><a href="#cb23-383" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span> pred1<span class="sc">$</span>actual, </span>
<span id="cb23-384"><a href="#cb23-384" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="st">'Actual value of Testing'</span>,</span>
<span id="cb23-385"><a href="#cb23-385" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-386"><a href="#cb23-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span> pred1<span class="sc">$</span>date, </span>
<span id="cb23-387"><a href="#cb23-387" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span> pred1<span class="sc">$</span>predict, </span>
<span id="cb23-388"><a href="#cb23-388" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="st">'Predicted value of Testing'</span>, </span>
<span id="cb23-389"><a href="#cb23-389" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">dash =</span> <span class="st">'dot'</span>,</span>
<span id="cb23-390"><a href="#cb23-390" aria-hidden="true" tabindex="-1"></a>                        <span class="at">width =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-391"><a href="#cb23-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span> pred2<span class="sc">$</span>date, </span>
<span id="cb23-392"><a href="#cb23-392" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span> pred2<span class="sc">$</span>actual, </span>
<span id="cb23-393"><a href="#cb23-393" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="st">'Actual of Forecasting'</span>,</span>
<span id="cb23-394"><a href="#cb23-394" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-395"><a href="#cb23-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span> pred2<span class="sc">$</span>date, </span>
<span id="cb23-396"><a href="#cb23-396" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span> pred2<span class="sc">$</span>predict, </span>
<span id="cb23-397"><a href="#cb23-397" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="st">'Predicted of Forecasting'</span>, </span>
<span id="cb23-398"><a href="#cb23-398" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">dash =</span> <span class="st">'dot'</span>,</span>
<span id="cb23-399"><a href="#cb23-399" aria-hidden="true" tabindex="-1"></a>                        <span class="at">width =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-400"><a href="#cb23-400" aria-hidden="true" tabindex="-1"></a>   <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Evaluating the model's forecasting result"</span>,</span>
<span id="cb23-401"><a href="#cb23-401" aria-hidden="true" tabindex="-1"></a>           <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Order Demand'</span>),</span>
<span id="cb23-402"><a href="#cb23-402" aria-hidden="true" tabindex="-1"></a>           <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Time'</span>)</span>
<span id="cb23-403"><a href="#cb23-403" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb23-404"><a href="#cb23-404" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-405"><a href="#cb23-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-406"><a href="#cb23-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-409"><a href="#cb23-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-410"><a href="#cb23-410" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_f</span>(rft_model)</span>
<span id="cb23-411"><a href="#cb23-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-412"><a href="#cb23-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-413"><a href="#cb23-413" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mô hình GLM:</span></span>
<span id="cb23-414"><a href="#cb23-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-415"><a href="#cb23-415" aria-hidden="true" tabindex="-1"></a>Chúng ta thử thêm 1 số mô hình khác của ML. Ở dưới đây là mô hình **Geleralised linear model** sử dụng phương pháp OSL để tính toán.</span>
<span id="cb23-416"><a href="#cb23-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-419"><a href="#cb23-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-420"><a href="#cb23-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-421"><a href="#cb23-421" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-422"><a href="#cb23-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb23-423"><a href="#cb23-423" aria-hidden="true" tabindex="-1"></a><span class="co"># geleralised linear model:</span></span>
<span id="cb23-424"><a href="#cb23-424" aria-hidden="true" tabindex="-1"></a>glm_model <span class="ot">&lt;-</span> </span>
<span id="cb23-425"><a href="#cb23-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h2o.glm</span>(</span>
<span id="cb23-426"><a href="#cb23-426" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x, </span>
<span id="cb23-427"><a href="#cb23-427" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y, </span>
<span id="cb23-428"><a href="#cb23-428" aria-hidden="true" tabindex="-1"></a>    <span class="at">training_frame =</span> <span class="fu">as.h2o</span>(train_data),</span>
<span id="cb23-429"><a href="#cb23-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">nfolds =</span> <span class="dv">10</span>,</span>
<span id="cb23-430"><a href="#cb23-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb23-431"><a href="#cb23-431" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1975</span></span>
<span id="cb23-432"><a href="#cb23-432" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-433"><a href="#cb23-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-434"><a href="#cb23-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-437"><a href="#cb23-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-438"><a href="#cb23-438" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_f</span>(glm_model)</span>
<span id="cb23-439"><a href="#cb23-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-440"><a href="#cb23-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-441"><a href="#cb23-441" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mô hình Auto ML:</span></span>
<span id="cb23-442"><a href="#cb23-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-443"><a href="#cb23-443" aria-hidden="true" tabindex="-1"></a>Trong gói package **{h2o}** của R có mô hình "Auto Machine Learning" (AutoML) có thể tự động hóa quy trình đào tạo mô hình học máy được giám sát (supervised ML). AutoML tìm thấy mô hình tốt nhất, đưa ra khung đào tạo và phản hồi, đồng thời trả về đối tượng H2OAutoML, chứa bảng xếp hạng gồm tất cả các mô hình đã được đào tạo trong quy trình, được xếp hạng theo chỉ số hiệu suất mô hình mặc định.</span>
<span id="cb23-444"><a href="#cb23-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-447"><a href="#cb23-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-448"><a href="#cb23-448" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-449"><a href="#cb23-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-450"><a href="#cb23-450" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb23-451"><a href="#cb23-451" aria-hidden="true" tabindex="-1"></a>automl_model <span class="ot">&lt;-</span></span>
<span id="cb23-452"><a href="#cb23-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h2o.automl</span>(</span>
<span id="cb23-453"><a href="#cb23-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x,</span>
<span id="cb23-454"><a href="#cb23-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb23-455"><a href="#cb23-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">training_frame     =</span> <span class="fu">as.h2o</span>(train_data),</span>
<span id="cb23-456"><a href="#cb23-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">nfolds             =</span> <span class="dv">5</span>,</span>
<span id="cb23-457"><a href="#cb23-457" aria-hidden="true" tabindex="-1"></a>    <span class="at">stopping_metric    =</span> <span class="st">"RMSE"</span>,</span>
<span id="cb23-458"><a href="#cb23-458" aria-hidden="true" tabindex="-1"></a>    <span class="at">stopping_rounds    =</span> <span class="dv">10</span>,</span>
<span id="cb23-459"><a href="#cb23-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">stopping_tolerance =</span> <span class="fl">0.005</span>,</span>
<span id="cb23-460"><a href="#cb23-460" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_runtime_secs   =</span> <span class="dv">60</span>,</span>
<span id="cb23-461"><a href="#cb23-461" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed               =</span> <span class="dv">1975</span></span>
<span id="cb23-462"><a href="#cb23-462" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb23-463"><a href="#cb23-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-464"><a href="#cb23-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-467"><a href="#cb23-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-468"><a href="#cb23-468" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_f</span>(automl_model)</span>
<span id="cb23-469"><a href="#cb23-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-470"><a href="#cb23-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-471"><a href="#cb23-471" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mô hình Boosting:</span></span>
<span id="cb23-472"><a href="#cb23-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-473"><a href="#cb23-473" aria-hidden="true" tabindex="-1"></a>Tiếp đó, chúng ta sẽ thử với thuật toán boosting khá phổ biến là: *Stochastic Gradient Boosting*.</span>
<span id="cb23-474"><a href="#cb23-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-475"><a href="#cb23-475" aria-hidden="true" tabindex="-1"></a>Stochastic Gradient Boosting: Là một biến thể của gradient boosting, kết hợp các yếu tố ngẫu nhiên trong quá trình huấn luyện để cải thiện tính chính xác và khả năng tổng quát của mô hình. Thay vì sử dụng toàn bộ dữ liệu huấn luyện để xây dựng mỗi mô hình trong chuỗi, Stochastic Gradient Boosting chỉ sử dụng một mẫu ngẫu nhiên (subsample) của dữ liệu. Mỗi mô hình mới được huấn luyện để sửa chữa các sai số của các mô hình trước đó.</span>
<span id="cb23-476"><a href="#cb23-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-477"><a href="#cb23-477" aria-hidden="true" tabindex="-1"></a>Mục tiêu là giảm thiểu hàm mất mát (loss function) bằng cách sử dụng gradient descent.</span>
<span id="cb23-478"><a href="#cb23-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-481"><a href="#cb23-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-482"><a href="#cb23-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-483"><a href="#cb23-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-484"><a href="#cb23-484" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb23-485"><a href="#cb23-485" aria-hidden="true" tabindex="-1"></a><span class="co"># Tạo một đối tượng control cho cross-validation</span></span>
<span id="cb23-486"><a href="#cb23-486" aria-hidden="true" tabindex="-1"></a>fitControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">"repeatedcv"</span>, </span>
<span id="cb23-487"><a href="#cb23-487" aria-hidden="true" tabindex="-1"></a>                        <span class="at">number=</span><span class="dv">10</span>, </span>
<span id="cb23-488"><a href="#cb23-488" aria-hidden="true" tabindex="-1"></a>                        <span class="at">repeats=</span><span class="dv">10</span>)</span>
<span id="cb23-489"><a href="#cb23-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Trong đó</span></span>
<span id="cb23-490"><a href="#cb23-490" aria-hidden="true" tabindex="-1"></a><span class="co"># method = 'repeatedcv': sử dụng cross-validation với các tham số sau:</span></span>
<span id="cb23-491"><a href="#cb23-491" aria-hidden="true" tabindex="-1"></a><span class="co"># number = 10 có nhĩa là quá trình cross-validation cần chia dữ liệu gốc thành 10 phần bằng nhau</span></span>
<span id="cb23-492"><a href="#cb23-492" aria-hidden="true" tabindex="-1"></a><span class="co"># repeats = 10 có nghĩa là quá trình cross-validation cần lặp lại 10 lần</span></span>
<span id="cb23-493"><a href="#cb23-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-494"><a href="#cb23-494" aria-hidden="true" tabindex="-1"></a><span class="co"># Stochastic Gradient Boosting</span></span>
<span id="cb23-495"><a href="#cb23-495" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">825</span>)</span>
<span id="cb23-496"><a href="#cb23-496" aria-hidden="true" tabindex="-1"></a>gbmFit1 <span class="ot">&lt;-</span> <span class="fu">train</span>(Order_Demand<span class="sc">~</span>., </span>
<span id="cb23-497"><a href="#cb23-497" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> train_data <span class="sc">%&gt;%</span> </span>
<span id="cb23-498"><a href="#cb23-498" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(order_date,class)), </span>
<span id="cb23-499"><a href="#cb23-499" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"gbm"</span>,</span>
<span id="cb23-500"><a href="#cb23-500" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> fitControl,</span>
<span id="cb23-501"><a href="#cb23-501" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## This last option is actually one</span></span>
<span id="cb23-502"><a href="#cb23-502" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## for gbm() that passes through</span></span>
<span id="cb23-503"><a href="#cb23-503" aria-hidden="true" tabindex="-1"></a>                 <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-504"><a href="#cb23-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-505"><a href="#cb23-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-506"><a href="#cb23-506" aria-hidden="true" tabindex="-1"></a>Sau khi đã training model, ta sẽ dùng mô hình đó để dự đoán và so sánh với giá trị thực tế ở testing data. Ta sẽ có kết quả như dưới đây:</span>
<span id="cb23-507"><a href="#cb23-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-508"><a href="#cb23-508" aria-hidden="true" tabindex="-1"></a>Kết quả có vẻ ổn hơn Random Forest nhưng vẫn có 2 outliears vì độ chênh lệch lên đến 100-200%.</span>
<span id="cb23-509"><a href="#cb23-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-512"><a href="#cb23-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-513"><a href="#cb23-513" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb23-514"><a href="#cb23-514" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb23-515"><a href="#cb23-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout: [[30,70]]</span></span>
<span id="cb23-516"><a href="#cb23-516" aria-hidden="true" tabindex="-1"></a>predict<span class="ot">&lt;-</span><span class="fu">data.frame</span>(</span>
<span id="cb23-517"><a href="#cb23-517" aria-hidden="true" tabindex="-1"></a>  <span class="at">Period =</span> test_data<span class="sc">$</span>order_date,</span>
<span id="cb23-518"><a href="#cb23-518" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> <span class="fu">predict</span>(gbmFit1, </span>
<span id="cb23-519"><a href="#cb23-519" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newdata =</span> test_data <span class="sc">%&gt;%</span> </span>
<span id="cb23-520"><a href="#cb23-520" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(order_date,class))),</span>
<span id="cb23-521"><a href="#cb23-521" aria-hidden="true" tabindex="-1"></a>  <span class="at">Observed =</span> test_data<span class="sc">$</span>Order_Demand) <span class="sc">%&gt;%</span> </span>
<span id="cb23-522"><a href="#cb23-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Diff =</span> <span class="fu">round</span>((Observed <span class="sc">-</span> Predicted)<span class="sc">/</span>Observed<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb23-523"><a href="#cb23-523" aria-hidden="true" tabindex="-1"></a>         <span class="at">Check =</span> <span class="fu">ifelse</span>(Diff <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> Diff <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">5</span>, <span class="st">"Passed"</span>,<span class="st">"Failed"</span>))</span>
<span id="cb23-524"><a href="#cb23-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-525"><a href="#cb23-525" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb23-526"><a href="#cb23-526" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtExtras)</span>
<span id="cb23-527"><a href="#cb23-527" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(predict <span class="sc">%&gt;%</span> </span>
<span id="cb23-528"><a href="#cb23-528" aria-hidden="true" tabindex="-1"></a>     <span class="fu">count</span>(Check) <span class="sc">%&gt;%</span> </span>
<span id="cb23-529"><a href="#cb23-529" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">Per =</span> <span class="fu">round</span>(n<span class="sc">/</span><span class="fu">nrow</span>(predict),<span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb23-530"><a href="#cb23-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb23-531"><a href="#cb23-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">Check =</span> <span class="fu">md</span>(<span class="st">"**Status**"</span>),</span>
<span id="cb23-532"><a href="#cb23-532" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">md</span>(<span class="st">"**Count**"</span>),</span>
<span id="cb23-533"><a href="#cb23-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">Per =</span> <span class="fu">md</span>(<span class="st">"**Percentage**"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-534"><a href="#cb23-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb23-535"><a href="#cb23-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Evaluating the model's accuracy**"</span>),</span>
<span id="cb23-536"><a href="#cb23-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Forecasting from {min(test_data$order_date)} to {max(test_data$order_date)}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-537"><a href="#cb23-537" aria-hidden="true" tabindex="-1"></a>   <span class="fu">tab_source_note</span>(</span>
<span id="cb23-538"><a href="#cb23-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">source_note =</span> <span class="fu">str_glue</span>(<span class="st">"Smaller 5% means passed"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-539"><a href="#cb23-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_theme_538</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-540"><a href="#cb23-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_color</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Check"</span>),</span>
<span id="cb23-541"><a href="#cb23-541" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">"factor"</span>,</span>
<span id="cb23-542"><a href="#cb23-542" aria-hidden="true" tabindex="-1"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"blue"</span>))</span>
<span id="cb23-543"><a href="#cb23-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-544"><a href="#cb23-544" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> predict,</span>
<span id="cb23-545"><a href="#cb23-545" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Period, </span>
<span id="cb23-546"><a href="#cb23-546" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Diff)) <span class="sc">+</span> </span>
<span id="cb23-547"><a href="#cb23-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-548"><a href="#cb23-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb23-549"><a href="#cb23-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">1</span>, </span>
<span id="cb23-550"><a href="#cb23-550" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>, </span>
<span id="cb23-551"><a href="#cb23-551" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype=</span><span class="st">"dashed"</span>, </span>
<span id="cb23-552"><a href="#cb23-552" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb23-553"><a href="#cb23-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Time'</span>) <span class="sc">+</span></span>
<span id="cb23-554"><a href="#cb23-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Difference (%)'</span>) <span class="sc">+</span></span>
<span id="cb23-555"><a href="#cb23-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb23-556"><a href="#cb23-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Evaluating model builded by GBM method"</span>,</span>
<span id="cb23-557"><a href="#cb23-557" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Observed vs Predicted value"</span>,</span>
<span id="cb23-558"><a href="#cb23-558" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"The red line is abline Y = 0 means accuracry prediction and the blue line is the linear lines between observed and predicted value."</span>)</span>
<span id="cb23-559"><a href="#cb23-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-560"><a href="#cb23-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-561"><a href="#cb23-561" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tuning parameters:</span></span>
<span id="cb23-562"><a href="#cb23-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-563"><a href="#cb23-563" aria-hidden="true" tabindex="-1"></a>Tiêu đề của mục này là keyword mà bạn cần nắm về Machine Learning. Theo nghiên cứu của <span class="co">[</span><span class="ot">@dungnguyenchí</span><span class="co">]</span>, các thuật toán ML có các tham số mà việc điều chỉnh tham số sẽ ảnh hưởng đến kết quả dự đoán. Vậy chuyên đề tìm ra tham số tối ưu nhất là mục quan trọng khi bạn sử dụng ML.</span>
<span id="cb23-564"><a href="#cb23-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-565"><a href="#cb23-565" aria-hidden="true" tabindex="-1"></a>Về mặt lý thuyết, có nhiều cách để tìm ra, ở bài này mình sẽ sử dụng 3 cách là:</span>
<span id="cb23-566"><a href="#cb23-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-567"><a href="#cb23-567" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Full Grid Search.</span>
<span id="cb23-568"><a href="#cb23-568" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Random Search.</span>
<span id="cb23-569"><a href="#cb23-569" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Default Search.</span>
<span id="cb23-570"><a href="#cb23-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-571"><a href="#cb23-571" aria-hidden="true" tabindex="-1"></a>Và hầu như không có cách nào tìm ra tham số tối ưu nhất bằng cách thực nghiệm trên một bộ dữ liệu thực tế. Do đó, ở bài này, chúng ta sẽ lược qua cả 3 cách đã nêu trên và so sánh chúng để chọn ra các tối ưu nhất.</span>
<span id="cb23-572"><a href="#cb23-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-573"><a href="#cb23-573" aria-hidden="true" tabindex="-1"></a>Vậy có quá nhiều thuật toán ML vậy, làm sao ta biết được thuật toán nào cần chỉnh tham số nào? Trong R có hàm để chúng ta tự tìm hiểu, đó là <span class="in">`getModelInfo`</span>. Dưới đây là 1 ví dụ về thuật toán mà ta đã dùng ở trên:</span>
<span id="cb23-574"><a href="#cb23-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-577"><a href="#cb23-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-578"><a href="#cb23-578" aria-hidden="true" tabindex="-1"></a><span class="fu">getModelInfo</span>(<span class="st">"gbm"</span>)<span class="sc">$</span>gbm<span class="sc">$</span>parameters</span>
<span id="cb23-579"><a href="#cb23-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-580"><a href="#cb23-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-581"><a href="#cb23-581" aria-hidden="true" tabindex="-1"></a>Vậy tiếp theo chúng ta sẽ điều chỉnh tham số để tối ưu kết quả của mô hình. Chi tiết ở dưới phần code.</span>
<span id="cb23-582"><a href="#cb23-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-583"><a href="#cb23-583" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>number of iterations, i.e. trees, (called n.trees in the gbm function).</span>
<span id="cb23-584"><a href="#cb23-584" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>complexity of the tree, called interaction.depth learning rate: how quickly the algorithm adapts, called shrinkage.</span>
<span id="cb23-585"><a href="#cb23-585" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the minimum number of training set samples in a node to commence splitting (n.minobsinnode)</span>
<span id="cb23-586"><a href="#cb23-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-587"><a href="#cb23-587" aria-hidden="true" tabindex="-1"></a>Dựa trên hướng dẫn của <span class="co">[</span><span class="ot">@jasonbrownlee2020</span><span class="co">]</span>, ta sẽ thực hành qua cả 3 phương pháp. Code chi tiết dưới đây.</span>
<span id="cb23-588"><a href="#cb23-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-589"><a href="#cb23-589" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Phương pháp Random Search:</span></span>
<span id="cb23-590"><a href="#cb23-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-591"><a href="#cb23-591" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="minimal"}</span>
<span id="cb23-592"><a href="#cb23-592" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Random Search</span></span>
<span id="cb23-593"><a href="#cb23-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-594"><a href="#cb23-594" aria-hidden="true" tabindex="-1"></a>control <span class="sc">\&lt;</span>- trainControl(method="repeatedcv", number=10, repeats=3, search="random")</span>
<span id="cb23-595"><a href="#cb23-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-596"><a href="#cb23-596" aria-hidden="true" tabindex="-1"></a>mtry <span class="sc">\&lt;</span>- sqrt(ncol(train_data))</span>
<span id="cb23-597"><a href="#cb23-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-598"><a href="#cb23-598" aria-hidden="true" tabindex="-1"></a>gbm_random <span class="sc">\&lt;</span>- train(Order_Demand\~., data = train_data %<span class="sc">\&gt;</span>% select(-c(order_date,class)), method="gbm", tuneLength = 5, trControl = control)</span>
<span id="cb23-599"><a href="#cb23-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-600"><a href="#cb23-600" aria-hidden="true" tabindex="-1"></a>plot(gbm_random)</span>
<span id="cb23-601"><a href="#cb23-601" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb23-602"><a href="#cb23-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-603"><a href="#cb23-603" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Phương pháp Grid Search:</span></span>
<span id="cb23-604"><a href="#cb23-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-605"><a href="#cb23-605" aria-hidden="true" tabindex="-1"></a>Với phương pháp Grid Search, ta chỉ cần đổi đối số <span class="in">`search = "grid"`</span> và thêm đối số <span class="in">`tuneGrid`</span>.</span>
<span id="cb23-606"><a href="#cb23-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-607"><a href="#cb23-607" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="minimal"}</span>
<span id="cb23-608"><a href="#cb23-608" aria-hidden="true" tabindex="-1"></a><span class="fu">## Grid Search</span></span>
<span id="cb23-609"><a href="#cb23-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-610"><a href="#cb23-610" aria-hidden="true" tabindex="-1"></a>control <span class="sc">\&lt;</span>- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")</span>
<span id="cb23-611"><a href="#cb23-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-612"><a href="#cb23-612" aria-hidden="true" tabindex="-1"></a>tunegrid <span class="sc">\&lt;</span>- expand.grid(.mtry=c(1:5))</span>
<span id="cb23-613"><a href="#cb23-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-614"><a href="#cb23-614" aria-hidden="true" tabindex="-1"></a>gbm_gridsearch<span class="sc">\&lt;</span>-train(Order_Demand\~., data = train_data %<span class="sc">\&gt;</span>% select(-c(order_date,class)), method="gbm", tuneGrid=tunegrid, trControl = control)</span>
<span id="cb23-615"><a href="#cb23-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-616"><a href="#cb23-616" aria-hidden="true" tabindex="-1"></a>plot(gbm_gridsearch)</span>
<span id="cb23-617"><a href="#cb23-617" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb23-618"><a href="#cb23-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-619"><a href="#cb23-619" aria-hidden="true" tabindex="-1"></a>Cảm ơn các bạn đã ghé thăm và đọc bài viết của mình!!!</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© Copyright 2023, Loc cao</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>